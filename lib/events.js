"use strict";
var Events, ExperimentalProxyEventManager, ExtendedProxyEventManager, MessageQueue, ProxyEventManager, Session, Subscription, _,
  __slice = [].slice,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('underscore');

MessageQueue = (function() {
  function MessageQueue(limit) {
    this.limit = limit != null ? limit : 1000;
    this.queue = [];
  }

  MessageQueue.prototype.purge = function() {
    if (this.queue.length > this.limit) {
      return this.queue.splice(this.limit, this.queue.length - this.limit);
    }
  };

  MessageQueue.prototype.push = function(object) {
    this.purge();
    return this.queue.push(object);
  };

  MessageQueue.prototype.getLastItems = function(length) {
    if (length == null) {
      length = 100;
    }
    return this.queue.slice(0, length);
  };

  return MessageQueue;

})();

Session = (function() {
  function Session(messageQueueLimit) {
    this.messageQueueLimit = messageQueueLimit;
    this.pose = null;
    this.messagesQueue = new MessageQueue(this.messageQueueLimit);
    this.arm = this.direction = this.version = this.connectedTimestamp = this.armRecognizedTimestamp = null;
    this.extra = {};
  }

  Session.prototype.initialize = function() {};

  Session.prototype.onConnected = function(version, connectedTimestamp) {
    this.connectedTimestamp = connectedTimestamp;
    return this.version = version.join('.');
  };

  Session.prototype.onArmRecognized = function(arm, direction, armRecognizedTimestamp) {
    this.arm = arm;
    this.direction = direction;
    this.armRecognizedTimestamp = armRecognizedTimestamp;
  };

  Session.prototype.close = function() {};

  return Session;

})();

Subscription = (function() {
  function Subscription(callback, index, subscriptionList) {
    this.callback = callback;
    this.index = index;
    this.subscriptionList = subscriptionList;
  }

  Subscription.prototype.invoke = function() {
    var args;
    args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
    return this.callback.apply(this, args);
  };

  Subscription.prototype.dispose = function() {
    return this.subscriptionList.splice(this.index, 0);
  };

  return Subscription;

})();

Events = (function() {
  function Events() {
    this.events = {};
  }

  Events.prototype.on = function(eventName, listener) {
    var subscription, subscriptionList;
    if (!this.events[eventName]) {
      this.events[eventName] = [];
    }
    subscriptionList = this.events[eventName];
    subscription = new Subscription(listener, subscriptionList.length, subscriptionList);
    subscriptionList.push(subscription);
    return subscription;
  };

  Events.prototype.trigger = function() {
    var args, eventName, len, subscription, subscriptionList, _results;
    eventName = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
    subscriptionList = this.events[eventName] || [];
    len = subscriptionList.length;
    _results = [];
    while (len--) {
      subscription = subscriptionList[len];
      _results.push(subscription.invoke.apply(subscription, args));
    }
    return _results;
  };

  Events.prototype.off = function(eventName) {
    return this.events[eventName] = [];
  };

  return Events;

})();

ProxyEventManager = (function() {
  function ProxyEventManager() {}

  ProxyEventManager.prototype.handle = function(myo, eventData) {
    var handler;
    this.initSession(myo, eventData);
    myo.session.messagesQueue.push(eventData);
    handler = this.getHandler(eventData.type);
    return handler.call(this, myo, eventData);
  };

  ProxyEventManager.prototype.initSession = function(myo, eventData) {
    if (!myo.session) {
      myo.session = new Session();
      return false;
    }
    return true;
  };

  ProxyEventManager.prototype.removeSession = function(myo) {
    if (myo.session) {
      myo.session.close();
    }
    return myo.session = null;
  };

  ProxyEventManager.prototype.getHandler = function(eventType) {
    return this[eventType] || this["default"];
  };

  ProxyEventManager.prototype.arm_recognized = function(myo, eventData) {
    myo.session.onArmRecognized(eventData.arm, eventData.x_direction, eventData.timestamp);
    return myo.trigger('arm_recognized', eventData);
  };

  ProxyEventManager.prototype.arm_lost = function(myo, eventData) {
    this.removeSession(myo);
    return myo.trigger('arm_lost', eventData);
  };

  ProxyEventManager.prototype.paired = function(myo, eventData) {
    return myo.trigger('paired', eventData);
  };

  ProxyEventManager.prototype.pose = function(myo, eventData) {
    myo.session.pose = eventData.pose;
    return myo.trigger('pose', eventData.pose);
  };

  ProxyEventManager.prototype.orientation = function(myo, eventData) {
    return myo.trigger('orientation', eventData);
  };

  ProxyEventManager.prototype.rssi = function(myo, eventData) {
    return myo.trigger('bluetooth_strength', eventData.rssi);
  };

  ProxyEventManager.prototype.connected = function(myo, eventData) {
    myo.session.onConnected(eventData.version, eventData.timestamp);
    return myo.trigger('connected', eventData);
  };

  ProxyEventManager.prototype.disconnected = function(myo, eventData) {
    this.removeSession(myo);
    return myo.trigger('disconnected', eventData);
  };

  ProxyEventManager.prototype["default"] = function(myo, eventData) {
    return console.log('Unhandled event:', eventData);
  };

  return ProxyEventManager;

})();

ExtendedProxyEventManager = (function(_super) {
  __extends(ExtendedProxyEventManager, _super);

  function ExtendedProxyEventManager() {
    return ExtendedProxyEventManager.__super__.constructor.apply(this, arguments);
  }

  ExtendedProxyEventManager.prototype.orientation = function(myo, eventData) {
    var accelerometerData, gyroscopeData, imuData, orientationData, state;
    state = myo.session.extra;
    orientationData = {
      x: eventData.orientation.x - state.zeroOrientationOffset.x,
      y: eventData.orientation.y - state.zeroOrientationOffset.y,
      z: eventData.orientation.z - state.zeroOrientationOffset.z,
      w: eventData.orientation.w - state.zeroOrientationOffset.w
    };
    gyroscopeData = {
      x: eventData.gyroscope[0],
      y: eventData.gyroscope[1],
      z: eventData.gyroscope[2]
    };
    accelerometerData = {
      x: eventData.accelerometer[0],
      y: eventData.accelerometer[1],
      z: eventData.accelerometer[2]
    };
    imuData = {
      gyroscope: gyroscopeData,
      accelerometer: accelerometerData,
      orientation: orientationData
    };
    state.lastOrientationData = orientationData;
    ExtendedProxyEventManager.__super__.orientation.call(this, myo, orientationData);
    this.gyroscope(myo, gyroscopeData);
    this.accelerometer(myo, accelerometerData);
    return this.imu(myo, imuData);
  };

  ExtendedProxyEventManager.prototype.gyroscope = function(myo, eventData) {
    return myo.trigger('gyroscope', eventData);
  };

  ExtendedProxyEventManager.prototype.accelerometer = function(myo, eventData) {
    return myo.trigger('accelerometer', eventData);
  };

  ExtendedProxyEventManager.prototype.imu = function(myo, eventData) {
    return myo.trigger('imu', eventData);
  };

  return ExtendedProxyEventManager;

})(ProxyEventManager);

ExperimentalProxyEventManager = (function(_super) {
  __extends(ExperimentalProxyEventManager, _super);

  function ExperimentalProxyEventManager() {
    return ExperimentalProxyEventManager.__super__.constructor.apply(this, arguments);
  }

  ExperimentalProxyEventManager.prototype.initSession = function(myo) {
    var hadSession;
    hadSession = ExperimentalProxyEventManager.__super__.initSession.apply(this, arguments);
    if (!hadSession) {
      return _.extend(myo.session.extra, {
        wasRight: false,
        sensitivity: 20,
        lastIMU: null,
        doubleTap: {
          threshold: 0.9,
          time: [80, 300]
        },
        zeroOrientationOffset: {
          x: 0,
          y: 0,
          z: 0,
          w: 0
        }
      });
    }
  };

  ExperimentalProxyEventManager.prototype.accelerometer = function(myo, eventData) {
    var delta, diff, doubleTapOptions, last, state, y, z;
    ExperimentalProxyEventManager.__super__.accelerometer.apply(this, arguments);
    state = myo.session.extra;
    if (!state.lastIMU) {
      return;
    }
    doubleTapOptions = state.doubleTap;
    last = state.lastIMU.accelerometer;
    y = Math.abs(eventData.y);
    z = Math.abs(eventData.z);
    delta = Math.abs(Math.abs(last.y) - y) + Math.abs(Math.abs(last.z) - z);
    if (delta > doubleTapOptions.threshold) {
      if (state.last_tap) {
        diff = new Date().getTime() - state.last_tap;
        if (diff > doubleTapOptions.time[0] && diff < doubleTapOptions.time[1]) {
          this.double_tap(myo, eventData);
        }
      }
      return state.last_tap = new Date().getTime();
    }
  };

  ExperimentalProxyEventManager.prototype.double_tap = function(myo, eventData) {
    myo.trigger('double_tap', eventData);
    return myo.zeroOrientation();
  };

  return ExperimentalProxyEventManager;

})(ExtendedProxyEventManager);

_.extend(exports, {
  Events: Events,
  Subscription: Subscription,
  ProxyEventManager: ProxyEventManager,
  ExtendedProxyEventManager: ExtendedProxyEventManager,
  ExperimentalProxyEventManager: ExperimentalProxyEventManager
});

//# sourceMappingURL=data:application/json;base64,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QUEsQ0FBSixHQUF1QixLQUFLLENBQUMsUUFBcEMsQ0FBQTtBQUVBLFFBQUEsSUFBRyxJQUFBLEdBQU8sZ0JBQWdCLENBQUMsSUFBSyxDQUFBLENBQUEsQ0FBN0IsSUFBb0MsSUFBQSxHQUFPLGdCQUFnQixDQUFDLElBQUssQ0FBQSxDQUFBLENBQXBFO0FBRUUsVUFBQSxJQUFDLENBQUEsVUFBRCxDQUFZLEdBQVosRUFBaUIsU0FBakIsQ0FBQSxDQUZGO1NBSEY7T0FBQTthQU9BLEtBQUssQ0FBQyxRQUFOLEdBQXFCLElBQUEsSUFBQSxDQUFBLENBQU0sQ0FBQyxPQUFQLENBQUEsRUFSdkI7S0FqQmE7RUFBQSxDQWZmLENBQUE7O0FBQUEsMENBaUVBLFVBQUEsR0FBWSxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7QUFDVixJQUFBLEdBQUcsQ0FBQyxPQUFKLENBQVksWUFBWixFQUEwQixTQUExQixDQUFBLENBQUE7V0FHQSxHQUFHLENBQUMsZUFBSixDQUFBLEVBSlU7RUFBQSxDQWpFWixDQUFBOzt1Q0FBQTs7R0FEMEMsMEJBbE01QyxDQUFBOztBQUFBLENBMlFDLENBQUMsTUFBRixDQUFTLE9BQVQsRUFBa0I7QUFBQSxFQUNoQixNQUFBLEVBQVEsTUFEUTtBQUFBLEVBRWhCLFlBQUEsRUFBYyxZQUZFO0FBQUEsRUFHaEIsaUJBQUEsRUFBbUIsaUJBSEg7QUFBQSxFQUloQix5QkFBQSxFQUEyQix5QkFKWDtBQUFBLEVBS2hCLDZCQUFBLEVBQStCLDZCQUxmO0NBQWxCLENBM1FBLENBQUEiLCJmaWxlIjoiZXZlbnRzLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCJcblxuXyA9IHJlcXVpcmUoJ3VuZGVyc2NvcmUnKVxuXG5cbmNsYXNzIE1lc3NhZ2VRdWV1ZVxuICBjb25zdHJ1Y3RvcjogKEBsaW1pdD0xMDAwKS0+XG4gICAgQHF1ZXVlID0gW11cblxuICBwdXJnZTogLT5cbiAgICBpZiBAcXVldWUubGVuZ3RoID4gQGxpbWl0XG4gICAgICBAcXVldWUuc3BsaWNlKEBsaW1pdCwgQHF1ZXVlLmxlbmd0aCAtIEBsaW1pdClcblxuICBwdXNoOiAob2JqZWN0KSAtPlxuICAgIEBwdXJnZSgpXG4gICAgcmV0dXJuIEBxdWV1ZS5wdXNoKG9iamVjdClcblxuICBnZXRMYXN0SXRlbXM6IChsZW5ndGg9MTAwKSAtPlxuICAgIHJldHVybiBAcXVldWUuc2xpY2UoMCwgbGVuZ3RoKVxuXG5cbmNsYXNzIFNlc3Npb25cbiAgIyBTZXNzaW9uIGNvbnN0cnVjdG9yXG4gICMgQHBhcmFtIHtTdHJpbmd9IGFybSB7bGVmdHxyaWdodH1cbiAgIyBAcGFyYW0ge1N0cmluZ30gZGlyZWN0aW9uICMgbm90IHN1cmUgYWJvdXQgdGhpcyBvbmVcbiAgY29uc3RydWN0b3I6IChAbWVzc2FnZVF1ZXVlTGltaXQpIC0+XG4gICAgQHBvc2UgPSBudWxsXG4gICAgQG1lc3NhZ2VzUXVldWUgPSBuZXcgTWVzc2FnZVF1ZXVlKEBtZXNzYWdlUXVldWVMaW1pdClcbiAgICBAYXJtID0gQGRpcmVjdGlvbiA9IEB2ZXJzaW9uID0gQGNvbm5lY3RlZFRpbWVzdGFtcCA9IEBhcm1SZWNvZ25pemVkVGltZXN0YW1wID0gbnVsbFxuXG4gICAgIyB0aGlzIG9iamVjdCBjYW4gYmUgdXNlZCBieSBjdXN0b20gZXZlbnRzIHRvIHN0b3JlIGFkZGl0aW9uYWwgZGF0YVxuICAgIEBleHRyYSA9IHt9XG5cbiAgaW5pdGlhbGl6ZTogLT5cbiAgICAjIGhlcmUgSSB3YW50IHRvIGFkZCBhbiBpbml0aWFsaXphdGlvbiBvZiB0aGUgdXNlciBzZXNzaW9uIG9uIHRoZSBhcm1iYW5kLFxuICAgICMgcmVnaXN0ZXJpbmcgY29tbW9uIGFjdGlvbnMganVzdCB0byBrbm93IHRoZSB1c2VyIGJldHRlciBhbmQgYWRhcHQgdG8gaGlzXG4gICAgIyBoYWJpdHMgZXZlcnkgcGVyc29uIGhhcyBhIGRpZmZlcmVudCBzdHJlbmd0aCB3aGVuIHBlcmZvcm1pbmcgZGlmZmVyZW50XG4gICAgIyBhY3Rpb25zLCByZWdpc3RlcmluZyBjb21tb25nIGFjdGlvbnMgd2lsbCBtYWtlIGl0IGVhc2llciB0byBhZGFwdFxuICAgICMgYWN0aW9ucyBiYXNlZCBvbiB1c2VyJ3Mgc2Vuc2l0aXZpdHlcblxuICBvbkNvbm5lY3RlZDogKHZlcnNpb24sIEBjb25uZWN0ZWRUaW1lc3RhbXApIC0+XG4gICAgQHZlcnNpb24gPSB2ZXJzaW9uLmpvaW4oJy4nKVxuXG4gIG9uQXJtUmVjb2duaXplZDogKEBhcm0sIEBkaXJlY3Rpb24sIEBhcm1SZWNvZ25pemVkVGltZXN0YW1wKSAtPlxuXG4gIGNsb3NlOiAtPlxuICAgICMgZG8gc29tZXRoaW5nPyBlbXB0eSB0aGUgbWVzc2FnZSBxdWV1ZT9cblxuXG5jbGFzcyBTdWJzY3JpcHRpb25cbiAgY29uc3RydWN0b3I6IChAY2FsbGJhY2ssIEBpbmRleCwgQHN1YnNjcmlwdGlvbkxpc3QpIC0+XG5cbiAgaW52b2tlOiAoYXJncy4uLiktPlxuICAgIEBjYWxsYmFjayhhcmdzLi4uKVxuXG4gIGRpc3Bvc2U6IC0+XG4gICAgQHN1YnNjcmlwdGlvbkxpc3Quc3BsaWNlKEBpbmRleCwgMClcblxuXG5jbGFzcyBFdmVudHNcbiAgY29uc3RydWN0b3I6IC0+XG4gICAgQGV2ZW50cyA9IHt9XG5cbiAgb246IChldmVudE5hbWUsIGxpc3RlbmVyKSAtPlxuICAgIGlmIG5vdCBAZXZlbnRzW2V2ZW50TmFtZV1cbiAgICAgIEBldmVudHNbZXZlbnROYW1lXSA9IFtdICAjIG5ldyBzdWJzY3JpcHRpb24gbGlzdCBmb3IgdGhpcyBuZXcgZXZlbnRcblxuICAgIHN1YnNjcmlwdGlvbkxpc3QgPSBAZXZlbnRzW2V2ZW50TmFtZV1cbiAgICBzdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKFxuICAgICAgbGlzdGVuZXIsXG4gICAgICBzdWJzY3JpcHRpb25MaXN0Lmxlbmd0aCxcbiAgICAgIHN1YnNjcmlwdGlvbkxpc3RcbiAgICApXG4gICAgc3Vic2NyaXB0aW9uTGlzdC5wdXNoKHN1YnNjcmlwdGlvbilcbiAgICByZXR1cm4gc3Vic2NyaXB0aW9uXG5cbiAgdHJpZ2dlcjogKGV2ZW50TmFtZSwgYXJncy4uLikgLT5cbiAgICBzdWJzY3JpcHRpb25MaXN0ID0gQGV2ZW50c1tldmVudE5hbWVdIG9yIFtdXG4gICAgbGVuID0gc3Vic2NyaXB0aW9uTGlzdC5sZW5ndGhcblxuICAgIHdoaWxlIGxlbi0tXG4gICAgICBzdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb25MaXN0W2xlbl1cbiAgICAgIHN1YnNjcmlwdGlvbi5pbnZva2UoYXJncy4uLilcblxuICBvZmY6IChldmVudE5hbWUpIC0+XG4gICAgIyB0aGlzIGNhbiBiZSB1c2VkIHRvIHJlbW92ZSBhbGwgc3Vic2NyaXB0aW9ucyB0byBhIHNwZWNpZmljIGV2ZW50LCB0b1xuICAgICMgZGlzcG9zZSBzaW5nbGUgc3Vic2NyaXB0aW9uIHVzZSB0aGUgZGlzcG9zZSBtZXRob2Qgb24gdGhlbVxuICAgIEBldmVudHNbZXZlbnROYW1lXSA9IFtdXG5cblxuY2xhc3MgUHJveHlFdmVudE1hbmFnZXJcbiAgIyBQcmVwYXJlcyBldmVudCBhbmQgZXZlbnQgZGF0YSB0byBiZSBwcm94aWVkIHRvIHRoZSBteW8gaW5zdGFuY2VcbiAgIyBJdCdzIGFsc28gcmVzcG9uc2libGUgdG8gY3JlYXRlIHNlc3Npb25zIGFuZCB1cGRhdGUgdGhlbSwgb24gbXlvIGluc3RhbmNlc1xuICAjIEJ5IGluaGVyaXRpbmcgZnJvbSB0aGlzIGNsYXNzLCBpdCBpcyBwb3NzaWJsZSB0byBleHRlbmQgdGhlIGxpc3Qgb2YgZXZlbnRzXG4gICMgYSBteW8gY2FuIHJlY29nbml6ZVxuICBoYW5kbGU6IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICBAaW5pdFNlc3Npb24obXlvLCBldmVudERhdGEpXG4gICAgbXlvLnNlc3Npb24ubWVzc2FnZXNRdWV1ZS5wdXNoKGV2ZW50RGF0YSlcbiAgICBoYW5kbGVyID0gQGdldEhhbmRsZXIoZXZlbnREYXRhLnR5cGUpXG4gICAgaGFuZGxlci5jYWxsKEAsIG15bywgZXZlbnREYXRhKVxuXG4gIGluaXRTZXNzaW9uOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgaWYgbm90IG15by5zZXNzaW9uXG4gICAgICBteW8uc2Vzc2lvbiA9IG5ldyBTZXNzaW9uKClcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIHJldHVybiB0cnVlXG5cbiAgcmVtb3ZlU2Vzc2lvbjogKG15bykgLT5cbiAgICBpZiBteW8uc2Vzc2lvblxuICAgICAgbXlvLnNlc3Npb24uY2xvc2UoKVxuXG4gICAgbXlvLnNlc3Npb24gPSBudWxsXG5cbiAgZ2V0SGFuZGxlcjogKGV2ZW50VHlwZSkgLT5cbiAgICByZXR1cm4gQFtldmVudFR5cGVdIG9yIEAuZGVmYXVsdFxuXG4gICMgaGFuZGxlcnNcbiAgYXJtX3JlY29nbml6ZWQ6IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICBteW8uc2Vzc2lvbi5vbkFybVJlY29nbml6ZWQoZXZlbnREYXRhLmFybSwgZXZlbnREYXRhLnhfZGlyZWN0aW9uLCBldmVudERhdGEudGltZXN0YW1wKVxuICAgIG15by50cmlnZ2VyKCdhcm1fcmVjb2duaXplZCcsIGV2ZW50RGF0YSlcblxuICBhcm1fbG9zdDogKG15bywgZXZlbnREYXRhKSAtPlxuICAgIEByZW1vdmVTZXNzaW9uKG15bylcbiAgICBteW8udHJpZ2dlcignYXJtX2xvc3QnLCBldmVudERhdGEpXG5cbiAgcGFpcmVkOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgbXlvLnRyaWdnZXIoJ3BhaXJlZCcsIGV2ZW50RGF0YSlcblxuICBwb3NlOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgbXlvLnNlc3Npb24ucG9zZSA9IGV2ZW50RGF0YS5wb3NlXG4gICAgbXlvLnRyaWdnZXIoJ3Bvc2UnLCBldmVudERhdGEucG9zZSlcblxuICBvcmllbnRhdGlvbjogKG15bywgZXZlbnREYXRhKSAtPlxuICAgIG15by50cmlnZ2VyKCdvcmllbnRhdGlvbicsIGV2ZW50RGF0YSlcblxuICByc3NpOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgbXlvLnRyaWdnZXIoJ2JsdWV0b290aF9zdHJlbmd0aCcsIGV2ZW50RGF0YS5yc3NpKVxuXG4gIGNvbm5lY3RlZDogKG15bywgZXZlbnREYXRhKSAtPlxuICAgIG15by5zZXNzaW9uLm9uQ29ubmVjdGVkKGV2ZW50RGF0YS52ZXJzaW9uLCBldmVudERhdGEudGltZXN0YW1wKVxuICAgIG15by50cmlnZ2VyKCdjb25uZWN0ZWQnLCBldmVudERhdGEpXG5cbiAgZGlzY29ubmVjdGVkOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgIyBkZXN0cm95IG15byBpbnN0YW5jZT9cbiAgICBAcmVtb3ZlU2Vzc2lvbihteW8pXG4gICAgbXlvLnRyaWdnZXIoJ2Rpc2Nvbm5lY3RlZCcsIGV2ZW50RGF0YSlcblxuICBkZWZhdWx0OiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgY29uc29sZS5sb2coJ1VuaGFuZGxlZCBldmVudDonLCBldmVudERhdGEpXG5cblxuY2xhc3MgRXh0ZW5kZWRQcm94eUV2ZW50TWFuYWdlciBleHRlbmRzIFByb3h5RXZlbnRNYW5hZ2VyXG4gIG9yaWVudGF0aW9uOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgIyBjb21wbGV0ZWx5IG92ZXJyaWRlcyBwYXJlbnQncyBvcmllbnRhdGlvbiBtZXRob2RcbiAgICAjIGFkZCBhbiBvZmZzZXQgdG8gdGhlIG9yaWVudGF0aW9uIGRhdGE/XG4gICAgc3RhdGUgPSBteW8uc2Vzc2lvbi5leHRyYVxuICAgIG9yaWVudGF0aW9uRGF0YSA9IHtcbiAgICAgIHg6IGV2ZW50RGF0YS5vcmllbnRhdGlvbi54IC0gc3RhdGUuemVyb09yaWVudGF0aW9uT2Zmc2V0LnhcbiAgICAgIHk6IGV2ZW50RGF0YS5vcmllbnRhdGlvbi55IC0gc3RhdGUuemVyb09yaWVudGF0aW9uT2Zmc2V0LnlcbiAgICAgIHo6IGV2ZW50RGF0YS5vcmllbnRhdGlvbi56IC0gc3RhdGUuemVyb09yaWVudGF0aW9uT2Zmc2V0LnpcbiAgICAgIHc6IGV2ZW50RGF0YS5vcmllbnRhdGlvbi53IC0gc3RhdGUuemVyb09yaWVudGF0aW9uT2Zmc2V0LndcbiAgICB9XG4gICAgZ3lyb3Njb3BlRGF0YSA9IHtcbiAgICAgIHg6IGV2ZW50RGF0YS5neXJvc2NvcGVbMF1cbiAgICAgIHk6IGV2ZW50RGF0YS5neXJvc2NvcGVbMV1cbiAgICAgIHo6IGV2ZW50RGF0YS5neXJvc2NvcGVbMl1cbiAgICB9XG4gICAgYWNjZWxlcm9tZXRlckRhdGEgPSB7XG4gICAgICB4OiBldmVudERhdGEuYWNjZWxlcm9tZXRlclswXVxuICAgICAgeTogZXZlbnREYXRhLmFjY2VsZXJvbWV0ZXJbMV1cbiAgICAgIHo6IGV2ZW50RGF0YS5hY2NlbGVyb21ldGVyWzJdXG4gICAgfVxuICAgIGltdURhdGEgPSB7XG4gICAgICBneXJvc2NvcGU6IGd5cm9zY29wZURhdGFcbiAgICAgIGFjY2VsZXJvbWV0ZXI6IGFjY2VsZXJvbWV0ZXJEYXRhXG4gICAgICBvcmllbnRhdGlvbjogb3JpZW50YXRpb25EYXRhXG4gICAgfVxuICAgIHN0YXRlLmxhc3RPcmllbnRhdGlvbkRhdGEgPSBvcmllbnRhdGlvbkRhdGFcblxuICAgIHN1cGVyKG15bywgb3JpZW50YXRpb25EYXRhKVxuICAgIEBneXJvc2NvcGUobXlvLCBneXJvc2NvcGVEYXRhKVxuICAgIEBhY2NlbGVyb21ldGVyKG15bywgYWNjZWxlcm9tZXRlckRhdGEpXG4gICAgQGltdShteW8sIGltdURhdGEpXG5cbiAgZ3lyb3Njb3BlOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgbXlvLnRyaWdnZXIoJ2d5cm9zY29wZScsIGV2ZW50RGF0YSlcblxuICBhY2NlbGVyb21ldGVyOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgbXlvLnRyaWdnZXIoJ2FjY2VsZXJvbWV0ZXInLCBldmVudERhdGEpXG5cbiAgaW11OiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgbXlvLnRyaWdnZXIoJ2ltdScsIGV2ZW50RGF0YSlcblxuXG5jbGFzcyBFeHBlcmltZW50YWxQcm94eUV2ZW50TWFuYWdlciBleHRlbmRzIEV4dGVuZGVkUHJveHlFdmVudE1hbmFnZXJcbiAgaW5pdFNlc3Npb246IChteW8pIC0+XG4gICAgaGFkU2Vzc2lvbiA9IHN1cGVyXG5cbiAgICBpZiBub3QgaGFkU2Vzc2lvblxuICAgICAgXy5leHRlbmQobXlvLnNlc3Npb24uZXh0cmEsIHtcbiAgICAgICAgd2FzUmlnaHQ6IGZhbHNlXG4gICAgICAgIHNlbnNpdGl2aXR5OiAyMFxuICAgICAgICBsYXN0SU1VOiBudWxsXG4gICAgICAgIGRvdWJsZVRhcDoge1xuICAgICAgICAgIHRocmVzaG9sZDogMC45XG4gICAgICAgICAgdGltZTogWzgwLCAzMDBdXG4gICAgICAgIH1cbiAgICAgICAgemVyb09yaWVudGF0aW9uT2Zmc2V0OiB7eDogMCwgeTogMCwgejogMCwgdzogMH1cbiAgICAgIH0pXG5cbiAgYWNjZWxlcm9tZXRlcjogKG15bywgZXZlbnREYXRhKSAtPlxuICAgICMgYWRkIGRvdWJsZV90YXAgZXZlbnRcbiAgICAjIGFsbCByaWdodHMgZm9yIHRoaXMgZXZlbnQgZ28gdG8gc3RvbGtzZG9yZiAoIGh0dHBzOi8vZ2l0aHViLmNvbS9zdG9sa3Nkb3JmL215by5qcy5naXQgKVxuICAgIHN1cGVyXG5cbiAgICBzdGF0ZSA9IG15by5zZXNzaW9uLmV4dHJhXG5cbiAgICBpZiBub3Qgc3RhdGUubGFzdElNVVxuICAgICAgcmV0dXJuXG5cbiAgICBkb3VibGVUYXBPcHRpb25zID0gc3RhdGUuZG91YmxlVGFwXG4gICAgbGFzdCA9IHN0YXRlLmxhc3RJTVUuYWNjZWxlcm9tZXRlclxuXG4gICAgeSA9IE1hdGguYWJzKGV2ZW50RGF0YS55KVxuICAgIHogPSBNYXRoLmFicyhldmVudERhdGEueilcbiAgICBkZWx0YSA9IE1hdGguYWJzKE1hdGguYWJzKGxhc3QueSkgLSB5KSArIE1hdGguYWJzKE1hdGguYWJzKGxhc3QueikgLSB6KVxuXG4gICAgaWYgZGVsdGEgPiBkb3VibGVUYXBPcHRpb25zLnRocmVzaG9sZFxuICAgICAgaWYgc3RhdGUubGFzdF90YXBcbiAgICAgICAgZGlmZiA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gc3RhdGUubGFzdF90YXBcblxuICAgICAgICBpZiBkaWZmID4gZG91YmxlVGFwT3B0aW9ucy50aW1lWzBdIGFuZCBkaWZmIDwgZG91YmxlVGFwT3B0aW9ucy50aW1lWzFdXG4gICAgICAgICAgIyB0cmlnZ2VyIGRvdWJsZSB0YXAgZXZlbnRcbiAgICAgICAgICBAZG91YmxlX3RhcChteW8sIGV2ZW50RGF0YSlcblxuICAgICAgc3RhdGUubGFzdF90YXAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuXG4jICBpbXU6IChteW8sIGV2ZW50RGF0YSkgLT5cbiMgICAgIyBhZGQgc2xhcF9sZWZ0IGV2ZW50XG4jICAgIG15by5zZXNzaW9uLmV4dHJhLmxhc3RJTVUgPSBldmVudERhdGFcbiMgICAgc3VwZXJcbiMgICAgZXZlbnREYXRhID0gZXZlbnREYXRhLm9yaWVudGF0aW9uXG4jXG4jICAgIHN0YXRlID0gbXlvLnNlc3Npb24uZXh0cmFcbiMgICAgc2Vuc1JpZ2h0ID0gKDIwICsgc3RhdGUuc2Vuc2l0aXZpdHkpICogLTFcbiNcbiMgICAgaWYgZXZlbnREYXRhLnggPCBzZW5zUmlnaHQgYW5kIG5vdCBzdGF0ZS53YXNSaWdodFxuIyAgICAgIHN0YXRlLndhc1JpZ2h0ID0gdHJ1ZVxuIyAgICAgIHJldHVyblxuI1xuIyAgICBzZW5zTGVmdCA9IDgwICsgKHN0YXRlLnNlbnNpdGl2aXR5ICogMilcbiNcbiMgICAgaWYgZXZlbnREYXRhLnggPiBzZW5zTGVmdCBhbmQgc3RhdGUud2FzUmlnaHRcbiMgICAgICAjIHRyaWdnZXIgc2xhcCBsZWZ0IGV2ZW50XG4jICAgICAgQHNsYXBfbGVmdChteW8sIGV2ZW50RGF0YSlcbiMgICAgICBzdGF0ZS53YXNSaWdodCA9IGZhbHNlXG4jXG4jICBzbGFwX2xlZnQ6IChteW8sIGV2ZW50RGF0YSkgLT5cbiMgICAgbXlvLnRyaWdnZXIoJ3NsYXBfbGVmdCcsIGV2ZW50RGF0YSlcblxuICBkb3VibGVfdGFwOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgbXlvLnRyaWdnZXIoJ2RvdWJsZV90YXAnLCBldmVudERhdGEpXG5cbiAgICAjIGFsc28gcmVzZXQgbXlvJ3Mgb3JpZW50YXRpb24gP1xuICAgIG15by56ZXJvT3JpZW50YXRpb24oKVxuXG5cbl8uZXh0ZW5kKGV4cG9ydHMsIHtcbiAgRXZlbnRzOiBFdmVudHNcbiAgU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb25cbiAgUHJveHlFdmVudE1hbmFnZXI6IFByb3h5RXZlbnRNYW5hZ2VyXG4gIEV4dGVuZGVkUHJveHlFdmVudE1hbmFnZXI6IEV4dGVuZGVkUHJveHlFdmVudE1hbmFnZXJcbiAgRXhwZXJpbWVudGFsUHJveHlFdmVudE1hbmFnZXI6IEV4cGVyaW1lbnRhbFByb3h5RXZlbnRNYW5hZ2VyXG59KVxuIl19