"use strict";
var Events, ExperimentalProxyEventManager, ExtendedProxyEventManager, ProxyEventManager, Session, Subscription, _,
  __slice = [].slice,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('underscore');

Session = (function() {
  function Session(arm, direction) {
    this.arm = arm;
    this.direction = direction;
    this.pose = null;
    this.messagesQueue = [];
  }

  Session.prototype.initialize = function() {};

  Session.prototype.close = function() {};

  return Session;

})();

Subscription = (function() {
  function Subscription(callback, index, subscriptionList) {
    this.callback = callback;
    this.index = index;
    this.subscriptionList = subscriptionList;
  }

  Subscription.prototype.invoke = function() {
    var args;
    args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
    return this.callback.apply(this, args);
  };

  Subscription.prototype.dispose = function() {
    return this.subscriptionList.splice(this.index, 0);
  };

  return Subscription;

})();

Events = (function() {
  function Events() {
    this.events = {};
  }

  Events.prototype.on = function(eventName, listener) {
    var subscription, subscriptionList;
    if (!this.events[eventName]) {
      this.events[eventName] = [];
    }
    subscriptionList = this.events[eventName];
    subscription = new Subscription(listener, subscriptionList.length, subscriptionList);
    subscriptionList.push(subscription);
    return subscription;
  };

  Events.prototype.trigger = function() {
    var args, eventName, len, subscription, subscriptionList, _results;
    eventName = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
    subscriptionList = this.events[eventName] || [];
    len = subscriptionList.length;
    _results = [];
    while (len--) {
      subscription = subscriptionList[len];
      _results.push(subscription.invoke.apply(subscription, args));
    }
    return _results;
  };

  Events.prototype.off = function(eventName) {
    return this.events[eventName] = [];
  };

  return Events;

})();

ProxyEventManager = (function() {
  function ProxyEventManager() {}

  ProxyEventManager.prototype.handle = function(myo, eventData) {
    var handler;
    this.initSession(myo, eventData);
    handler = this.getHandler(eventData.type);
    return handler.call(this, myo, eventData);
  };

  ProxyEventManager.prototype.initSession = function(myo, eventData) {
    if (!myo.session) {
      myo.session = new Session(eventData.arm, eventData.x_direction);
      return false;
    }
    return true;
  };

  ProxyEventManager.prototype.removeSession = function(myo) {
    if (myo.session) {
      myo.session.close();
    }
    return myo.session = null;
  };

  ProxyEventManager.prototype.getHandler = function(eventType) {
    return this[eventType] || this["default"];
  };

  ProxyEventManager.prototype.arm_recognized = function(myo, eventData) {
    return myo.trigger('arm_recognized', eventData);
  };

  ProxyEventManager.prototype.arm_lost = function(myo, eventData) {
    this.removeSession();
    return myo.trigger('arm_lost', eventData);
  };

  ProxyEventManager.prototype.paired = function(myo, eventData) {
    return myo.trigger('paired', eventData);
  };

  ProxyEventManager.prototype.pose = function(myo, eventData) {
    myo.session.pose = eventData.pose;
    return myo.trigger('pose', eventData.pose);
  };

  ProxyEventManager.prototype.orientation = function(myo, eventData) {
    return myo.trigger('orientation', eventData);
  };

  ProxyEventManager.prototype.rssi = function(myo, eventData) {
    return myo.trigger('bluetooth_strength', eventData.rssi);
  };

  ProxyEventManager.prototype.connected = function(myo, eventData) {
    return myo.trigger('connected', eventData);
  };

  ProxyEventManager.prototype.disconnected = function(myo, eventData) {
    this.removeSession();
    return myo.trigger('disconnected', eventData);
  };

  ProxyEventManager.prototype["default"] = function(myo, eventData) {
    return console.log('Unhandled event:', eventData);
  };

  return ProxyEventManager;

})();

ExtendedProxyEventManager = (function(_super) {
  __extends(ExtendedProxyEventManager, _super);

  function ExtendedProxyEventManager() {
    return ExtendedProxyEventManager.__super__.constructor.apply(this, arguments);
  }

  ExtendedProxyEventManager.prototype.orientation = function(myo, eventData) {
    var accelerometerData, gyroscopeData, imuData, orientationData;
    orientationData = {
      x: eventData.orientation.x,
      y: eventData.orientation.y,
      z: eventData.orientation.z,
      w: eventData.orientation.w
    };
    gyroscopeData = {
      x: eventData.gyroscope[0],
      y: eventData.gyroscope[1],
      z: eventData.gyroscope[2]
    };
    accelerometerData = {
      x: eventData.accelerometer[0],
      y: eventData.accelerometer[1],
      z: eventData.accelerometer[2]
    };
    imuData = {
      gyroscope: gyroscopeData,
      accelerometer: accelerometerData,
      orientation: orientationData
    };
    myo.trigger('orientation', orientationData);
    this.gyroscope(myo, gyroscopeData);
    this.accelerometer(myo, accelerometerData);
    return this.imu(myo, imuData);
  };

  ExtendedProxyEventManager.prototype.gyroscope = function(myo, eventData) {
    return myo.trigger('gyroscope', eventData);
  };

  ExtendedProxyEventManager.prototype.accelerometer = function(myo, eventData) {
    return myo.trigger('accelerometer', eventData);
  };

  ExtendedProxyEventManager.prototype.imu = function(myo, eventData) {
    return myo.trigger('imu', eventData);
  };

  return ExtendedProxyEventManager;

})(ProxyEventManager);

ExperimentalProxyEventManager = (function(_super) {
  __extends(ExperimentalProxyEventManager, _super);

  function ExperimentalProxyEventManager() {
    return ExperimentalProxyEventManager.__super__.constructor.apply(this, arguments);
  }

  ExperimentalProxyEventManager.prototype.initSession = function(myo, eventData) {
    var hadSession;
    hadSession = ExperimentalProxyEventManager.__super__.initSession.apply(this, arguments);
    if (!hadSession) {
      myo.session.wasRight = false;
      myo.session.sensitivity = 20;
      myo.session.lastIMU = null;
      return myo.session.doubleTap = {
        threshold: 0.9,
        time: [80, 300]
      };
    }
  };

  ExperimentalProxyEventManager.prototype.imu = function(myo, eventData) {
    myo.session.lastIMU = eventData;
    return ExperimentalProxyEventManager.__super__.imu.apply(this, arguments);
  };

  ExperimentalProxyEventManager.prototype.accelerometer = function(myo, eventData) {
    var delta, diff, doubleTapOptions, last, y, z;
    ExperimentalProxyEventManager.__super__.accelerometer.apply(this, arguments);
    if (!myo.session.lastIMU) {
      return;
    }
    doubleTapOptions = myo.session.doubleTap;
    last = myo.session.lastIMU.accelerometer;
    y = Math.abs(eventData.y);
    z = Math.abs(eventData.z);
    delta = Math.abs(Math.abs(last.y) - y) + Math.abs(Math.abs(last.z) - z);
    if (delta > doubleTapOptions.threshold) {
      if (myo.session.last_tap) {
        diff = new Date().getTime() - myo.session.last_tap;
        if (diff > doubleTapOptions.time[0] && diff < doubleTapOptions.time[1]) {
          this.double_tap(myo, eventData);
        }
      }
      return myo.session.last_tap = new Date().getTime();
    }
  };

  ExperimentalProxyEventManager.prototype.gyroscope = function(myo, eventData) {
    var sensLeft, sensRight;
    ExperimentalProxyEventManager.__super__.gyroscope.apply(this, arguments);
    sensRight = (20 + myo.session.sensitivity) * -1;
    if (eventData.x < sensRight && !myo.session.wasRight) {
      myo.session.wasRight = true;
      return;
    }
    sensLeft = 80 + (myo.session.sensitivity * 2);
    if (eventData.x > sensLeft && myo.session.wasRight) {
      this.slap_left(myo, eventData);
      return myo.session.wasRight = false;
    }
  };

  ExperimentalProxyEventManager.prototype.double_tap = function(myo, eventData) {
    return myo.trigger('double_tap', eventData);
  };

  ExperimentalProxyEventManager.prototype.slap_left = function(myo, eventData) {
    return myo.trigger('slap_left', eventData);
  };

  return ExperimentalProxyEventManager;

})(ExtendedProxyEventManager);

_.extend(exports, {
  Events: Events,
  Subscription: Subscription,
  ProxyEventManager: ProxyEventManager,
  ExtendedProxyEventManager: ExtendedProxyEventManager,
  ExperimentalProxyEventManager: ExperimentalProxyEventManager
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV2ZW50cy5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBQSxDQUFBO0FBQUEsSUFBQSw2R0FBQTtFQUFBOztpU0FBQTs7QUFBQSxDQUVBLEdBQUksT0FBQSxDQUFRLFlBQVIsQ0FGSixDQUFBOztBQUFBO0FBU2UsRUFBQSxpQkFBRSxHQUFGLEVBQVEsU0FBUixHQUFBO0FBQ1gsSUFEWSxJQUFDLENBQUEsTUFBQSxHQUNiLENBQUE7QUFBQSxJQURrQixJQUFDLENBQUEsWUFBQSxTQUNuQixDQUFBO0FBQUEsSUFBQSxJQUFDLENBQUEsSUFBRCxHQUFRLElBQVIsQ0FBQTtBQUFBLElBQ0EsSUFBQyxDQUFBLGFBQUQsR0FBaUIsRUFEakIsQ0FEVztFQUFBLENBQWI7O0FBQUEsb0JBSUEsVUFBQSxHQUFZLFNBQUEsR0FBQSxDQUpaLENBQUE7O0FBQUEsb0JBV0EsS0FBQSxHQUFPLFNBQUEsR0FBQSxDQVhQLENBQUE7O2lCQUFBOztJQVRGLENBQUE7O0FBQUE7QUF5QmUsRUFBQSxzQkFBRSxRQUFGLEVBQWEsS0FBYixFQUFxQixnQkFBckIsR0FBQTtBQUF3QyxJQUF2QyxJQUFDLENBQUEsV0FBQSxRQUFzQyxDQUFBO0FBQUEsSUFBNUIsSUFBQyxDQUFBLFFBQUEsS0FBMkIsQ0FBQTtBQUFBLElBQXBCLElBQUMsQ0FBQSxtQkFBQSxnQkFBbUIsQ0FBeEM7RUFBQSxDQUFiOztBQUFBLHlCQUVBLE1BQUEsR0FBUSxTQUFBLEdBQUE7QUFDTixRQUFBLElBQUE7QUFBQSxJQURPLDhEQUNQLENBQUE7V0FBQSxJQUFDLENBQUEsUUFBRCxhQUFVLElBQVYsRUFETTtFQUFBLENBRlIsQ0FBQTs7QUFBQSx5QkFLQSxPQUFBLEdBQVMsU0FBQSxHQUFBO1dBQ1AsSUFBQyxDQUFBLGdCQUFnQixDQUFDLE1BQWxCLENBQXlCLElBQUMsQ0FBQSxLQUExQixFQUFpQyxDQUFqQyxFQURPO0VBQUEsQ0FMVCxDQUFBOztzQkFBQTs7SUF6QkYsQ0FBQTs7QUFBQTtBQW1DZSxFQUFBLGdCQUFBLEdBQUE7QUFDWCxJQUFBLElBQUMsQ0FBQSxNQUFELEdBQVUsRUFBVixDQURXO0VBQUEsQ0FBYjs7QUFBQSxtQkFHQSxFQUFBLEdBQUksU0FBQyxTQUFELEVBQVksUUFBWixHQUFBO0FBQ0YsUUFBQSw4QkFBQTtBQUFBLElBQUEsSUFBRyxDQUFBLElBQUssQ0FBQSxNQUFPLENBQUEsU0FBQSxDQUFmO0FBQ0UsTUFBQSxJQUFDLENBQUEsTUFBTyxDQUFBLFNBQUEsQ0FBUixHQUFxQixFQUFyQixDQURGO0tBQUE7QUFBQSxJQUdBLGdCQUFBLEdBQW1CLElBQUMsQ0FBQSxNQUFPLENBQUEsU0FBQSxDQUgzQixDQUFBO0FBQUEsSUFJQSxZQUFBLEdBQW1CLElBQUEsWUFBQSxDQUNqQixRQURpQixFQUVqQixnQkFBZ0IsQ0FBQyxNQUZBLEVBR2pCLGdCQUhpQixDQUpuQixDQUFBO0FBQUEsSUFTQSxnQkFBZ0IsQ0FBQyxJQUFqQixDQUFzQixZQUF0QixDQVRBLENBQUE7QUFVQSxXQUFPLFlBQVAsQ0FYRTtFQUFBLENBSEosQ0FBQTs7QUFBQSxtQkFnQkEsT0FBQSxHQUFTLFNBQUEsR0FBQTtBQUNQLFFBQUEsOERBQUE7QUFBQSxJQURRLDBCQUFXLDhEQUNuQixDQUFBO0FBQUEsSUFBQSxnQkFBQSxHQUFtQixJQUFDLENBQUEsTUFBTyxDQUFBLFNBQUEsQ0FBUixJQUFzQixFQUF6QyxDQUFBO0FBQUEsSUFDQSxHQUFBLEdBQU0sZ0JBQWdCLENBQUMsTUFEdkIsQ0FBQTtBQUdBO1dBQU0sR0FBQSxFQUFOLEdBQUE7QUFDRSxNQUFBLFlBQUEsR0FBZSxnQkFBaUIsQ0FBQSxHQUFBLENBQWhDLENBQUE7QUFBQSxvQkFDQSxZQUFZLENBQUMsTUFBYixxQkFBb0IsSUFBcEIsRUFEQSxDQURGO0lBQUEsQ0FBQTtvQkFKTztFQUFBLENBaEJULENBQUE7O0FBQUEsbUJBd0JBLEdBQUEsR0FBSyxTQUFDLFNBQUQsR0FBQTtXQUdILElBQUMsQ0FBQSxNQUFPLENBQUEsU0FBQSxDQUFSLEdBQXFCLEdBSGxCO0VBQUEsQ0F4QkwsQ0FBQTs7Z0JBQUE7O0lBbkNGLENBQUE7O0FBQUE7aUNBc0VFOztBQUFBLDhCQUFBLE1BQUEsR0FBUSxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7QUFDTixRQUFBLE9BQUE7QUFBQSxJQUFBLElBQUMsQ0FBQSxXQUFELENBQWEsR0FBYixFQUFrQixTQUFsQixDQUFBLENBQUE7QUFBQSxJQUNBLE9BQUEsR0FBVSxJQUFDLENBQUEsVUFBRCxDQUFZLFNBQVMsQ0FBQyxJQUF0QixDQURWLENBQUE7V0FFQSxPQUFPLENBQUMsSUFBUixDQUFhLElBQWIsRUFBZ0IsR0FBaEIsRUFBcUIsU0FBckIsRUFITTtFQUFBLENBQVIsQ0FBQTs7QUFBQSw4QkFLQSxXQUFBLEdBQWEsU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO0FBQ1gsSUFBQSxJQUFHLENBQUEsR0FBTyxDQUFDLE9BQVg7QUFDRSxNQUFBLEdBQUcsQ0FBQyxPQUFKLEdBQWtCLElBQUEsT0FBQSxDQUFRLFNBQVMsQ0FBQyxHQUFsQixFQUF1QixTQUFTLENBQUMsV0FBakMsQ0FBbEIsQ0FBQTtBQUNBLGFBQU8sS0FBUCxDQUZGO0tBQUE7QUFHQSxXQUFPLElBQVAsQ0FKVztFQUFBLENBTGIsQ0FBQTs7QUFBQSw4QkFXQSxhQUFBLEdBQWUsU0FBQyxHQUFELEdBQUE7QUFDYixJQUFBLElBQUcsR0FBRyxDQUFDLE9BQVA7QUFDRSxNQUFBLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBWixDQUFBLENBQUEsQ0FERjtLQUFBO1dBR0EsR0FBRyxDQUFDLE9BQUosR0FBYyxLQUpEO0VBQUEsQ0FYZixDQUFBOztBQUFBLDhCQWlCQSxVQUFBLEdBQVksU0FBQyxTQUFELEdBQUE7QUFDVixXQUFPLElBQUUsQ0FBQSxTQUFBLENBQUYsSUFBZ0IsSUFBQyxDQUFDLFNBQUQsQ0FBeEIsQ0FEVTtFQUFBLENBakJaLENBQUE7O0FBQUEsOEJBcUJBLGNBQUEsR0FBZ0IsU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO1dBQ2QsR0FBRyxDQUFDLE9BQUosQ0FBWSxnQkFBWixFQUE4QixTQUE5QixFQURjO0VBQUEsQ0FyQmhCLENBQUE7O0FBQUEsOEJBd0JBLFFBQUEsR0FBVSxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7QUFDUixJQUFBLElBQUMsQ0FBQSxhQUFELENBQUEsQ0FBQSxDQUFBO1dBQ0EsR0FBRyxDQUFDLE9BQUosQ0FBWSxVQUFaLEVBQXdCLFNBQXhCLEVBRlE7RUFBQSxDQXhCVixDQUFBOztBQUFBLDhCQTRCQSxNQUFBLEdBQVEsU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO1dBQ04sR0FBRyxDQUFDLE9BQUosQ0FBWSxRQUFaLEVBQXNCLFNBQXRCLEVBRE07RUFBQSxDQTVCUixDQUFBOztBQUFBLDhCQStCQSxJQUFBLEdBQU0sU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO0FBQ0osSUFBQSxHQUFHLENBQUMsT0FBTyxDQUFDLElBQVosR0FBbUIsU0FBUyxDQUFDLElBQTdCLENBQUE7V0FDQSxHQUFHLENBQUMsT0FBSixDQUFZLE1BQVosRUFBb0IsU0FBUyxDQUFDLElBQTlCLEVBRkk7RUFBQSxDQS9CTixDQUFBOztBQUFBLDhCQW1DQSxXQUFBLEdBQWEsU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO1dBQ1gsR0FBRyxDQUFDLE9BQUosQ0FBWSxhQUFaLEVBQTJCLFNBQTNCLEVBRFc7RUFBQSxDQW5DYixDQUFBOztBQUFBLDhCQXNDQSxJQUFBLEdBQU0sU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO1dBQ0osR0FBRyxDQUFDLE9BQUosQ0FBWSxvQkFBWixFQUFrQyxTQUFTLENBQUMsSUFBNUMsRUFESTtFQUFBLENBdENOLENBQUE7O0FBQUEsOEJBeUNBLFNBQUEsR0FBVyxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7V0FFVCxHQUFHLENBQUMsT0FBSixDQUFZLFdBQVosRUFBeUIsU0FBekIsRUFGUztFQUFBLENBekNYLENBQUE7O0FBQUEsOEJBNkNBLFlBQUEsR0FBYyxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7QUFFWixJQUFBLElBQUMsQ0FBQSxhQUFELENBQUEsQ0FBQSxDQUFBO1dBQ0EsR0FBRyxDQUFDLE9BQUosQ0FBWSxjQUFaLEVBQTRCLFNBQTVCLEVBSFk7RUFBQSxDQTdDZCxDQUFBOztBQUFBLDhCQWtEQSxVQUFBLEdBQVMsU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO1dBQ1AsT0FBTyxDQUFDLEdBQVIsQ0FBWSxrQkFBWixFQUFnQyxTQUFoQyxFQURPO0VBQUEsQ0FsRFQsQ0FBQTs7MkJBQUE7O0lBdEVGLENBQUE7O0FBQUE7QUE2SEUsOENBQUEsQ0FBQTs7OztHQUFBOztBQUFBLHNDQUFBLFdBQUEsR0FBYSxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7QUFHWCxRQUFBLDBEQUFBO0FBQUEsSUFBQSxlQUFBLEdBQWtCO0FBQUEsTUFDaEIsQ0FBQSxFQUFHLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FEVDtBQUFBLE1BRWhCLENBQUEsRUFBRyxTQUFTLENBQUMsV0FBVyxDQUFDLENBRlQ7QUFBQSxNQUdoQixDQUFBLEVBQUcsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUhUO0FBQUEsTUFJaEIsQ0FBQSxFQUFHLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FKVDtLQUFsQixDQUFBO0FBQUEsSUFNQSxhQUFBLEdBQWdCO0FBQUEsTUFDZCxDQUFBLEVBQUcsU0FBUyxDQUFDLFNBQVUsQ0FBQSxDQUFBLENBRFQ7QUFBQSxNQUVkLENBQUEsRUFBRyxTQUFTLENBQUMsU0FBVSxDQUFBLENBQUEsQ0FGVDtBQUFBLE1BR2QsQ0FBQSxFQUFHLFNBQVMsQ0FBQyxTQUFVLENBQUEsQ0FBQSxDQUhUO0tBTmhCLENBQUE7QUFBQSxJQVdBLGlCQUFBLEdBQW9CO0FBQUEsTUFDbEIsQ0FBQSxFQUFHLFNBQVMsQ0FBQyxhQUFjLENBQUEsQ0FBQSxDQURUO0FBQUEsTUFFbEIsQ0FBQSxFQUFHLFNBQVMsQ0FBQyxhQUFjLENBQUEsQ0FBQSxDQUZUO0FBQUEsTUFHbEIsQ0FBQSxFQUFHLFNBQVMsQ0FBQyxhQUFjLENBQUEsQ0FBQSxDQUhUO0tBWHBCLENBQUE7QUFBQSxJQWdCQSxPQUFBLEdBQVU7QUFBQSxNQUNSLFNBQUEsRUFBVyxhQURIO0FBQUEsTUFFUixhQUFBLEVBQWUsaUJBRlA7QUFBQSxNQUdSLFdBQUEsRUFBYSxlQUhMO0tBaEJWLENBQUE7QUFBQSxJQXFCQSxHQUFHLENBQUMsT0FBSixDQUFZLGFBQVosRUFBMkIsZUFBM0IsQ0FyQkEsQ0FBQTtBQUFBLElBdUJBLElBQUMsQ0FBQSxTQUFELENBQVcsR0FBWCxFQUFnQixhQUFoQixDQXZCQSxDQUFBO0FBQUEsSUF3QkEsSUFBQyxDQUFBLGFBQUQsQ0FBZSxHQUFmLEVBQW9CLGlCQUFwQixDQXhCQSxDQUFBO1dBeUJBLElBQUMsQ0FBQSxHQUFELENBQUssR0FBTCxFQUFVLE9BQVYsRUE1Qlc7RUFBQSxDQUFiLENBQUE7O0FBQUEsc0NBOEJBLFNBQUEsR0FBVyxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7V0FDVCxHQUFHLENBQUMsT0FBSixDQUFZLFdBQVosRUFBeUIsU0FBekIsRUFEUztFQUFBLENBOUJYLENBQUE7O0FBQUEsc0NBaUNBLGFBQUEsR0FBZSxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7V0FDYixHQUFHLENBQUMsT0FBSixDQUFZLGVBQVosRUFBNkIsU0FBN0IsRUFEYTtFQUFBLENBakNmLENBQUE7O0FBQUEsc0NBb0NBLEdBQUEsR0FBSyxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7V0FDSCxHQUFHLENBQUMsT0FBSixDQUFZLEtBQVosRUFBbUIsU0FBbkIsRUFERztFQUFBLENBcENMLENBQUE7O21DQUFBOztHQURzQyxrQkE1SHhDLENBQUE7O0FBQUE7QUFzS0Usa0RBQUEsQ0FBQTs7OztHQUFBOztBQUFBLDBDQUFBLFdBQUEsR0FBYSxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7QUFDWCxRQUFBLFVBQUE7QUFBQSxJQUFBLFVBQUEsR0FBYSxnRUFBQSxTQUFBLENBQWIsQ0FBQTtBQUVBLElBQUEsSUFBRyxDQUFBLFVBQUg7QUFDRSxNQUFBLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBWixHQUF1QixLQUF2QixDQUFBO0FBQUEsTUFDQSxHQUFHLENBQUMsT0FBTyxDQUFDLFdBQVosR0FBMEIsRUFEMUIsQ0FBQTtBQUFBLE1BRUEsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFaLEdBQXNCLElBRnRCLENBQUE7YUFHQSxHQUFHLENBQUMsT0FBTyxDQUFDLFNBQVosR0FBd0I7QUFBQSxRQUN0QixTQUFBLEVBQVcsR0FEVztBQUFBLFFBRXRCLElBQUEsRUFBTSxDQUFDLEVBQUQsRUFBSyxHQUFMLENBRmdCO1FBSjFCO0tBSFc7RUFBQSxDQUFiLENBQUE7O0FBQUEsMENBWUEsR0FBQSxHQUFLLFNBQUMsR0FBRCxFQUFNLFNBQU4sR0FBQTtBQUNILElBQUEsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFaLEdBQXNCLFNBQXRCLENBQUE7V0FDQSx3REFBQSxTQUFBLEVBRkc7RUFBQSxDQVpMLENBQUE7O0FBQUEsMENBZ0JBLGFBQUEsR0FBZSxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7QUFHYixRQUFBLHlDQUFBO0FBQUEsSUFBQSxrRUFBQSxTQUFBLENBQUEsQ0FBQTtBQUVBLElBQUEsSUFBRyxDQUFBLEdBQU8sQ0FBQyxPQUFPLENBQUMsT0FBbkI7QUFDRSxZQUFBLENBREY7S0FGQTtBQUFBLElBS0EsZ0JBQUEsR0FBbUIsR0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUwvQixDQUFBO0FBQUEsSUFNQSxJQUFBLEdBQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsYUFOM0IsQ0FBQTtBQUFBLElBUUEsQ0FBQSxHQUFJLElBQUksQ0FBQyxHQUFMLENBQVMsU0FBUyxDQUFDLENBQW5CLENBUkosQ0FBQTtBQUFBLElBU0EsQ0FBQSxHQUFJLElBQUksQ0FBQyxHQUFMLENBQVMsU0FBUyxDQUFDLENBQW5CLENBVEosQ0FBQTtBQUFBLElBVUEsS0FBQSxHQUFRLElBQUksQ0FBQyxHQUFMLENBQVMsSUFBSSxDQUFDLEdBQUwsQ0FBUyxJQUFJLENBQUMsQ0FBZCxDQUFBLEdBQW1CLENBQTVCLENBQUEsR0FBaUMsSUFBSSxDQUFDLEdBQUwsQ0FBUyxJQUFJLENBQUMsR0FBTCxDQUFTLElBQUksQ0FBQyxDQUFkLENBQUEsR0FBbUIsQ0FBNUIsQ0FWekMsQ0FBQTtBQVlBLElBQUEsSUFBRyxLQUFBLEdBQVEsZ0JBQWdCLENBQUMsU0FBNUI7QUFDRSxNQUFBLElBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFmO0FBQ0UsUUFBQSxJQUFBLEdBQVcsSUFBQSxJQUFBLENBQUEsQ0FBTSxDQUFDLE9BQVAsQ0FBQSxDQUFKLEdBQXVCLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBMUMsQ0FBQTtBQUVBLFFBQUEsSUFBRyxJQUFBLEdBQU8sZ0JBQWdCLENBQUMsSUFBSyxDQUFBLENBQUEsQ0FBN0IsSUFBb0MsSUFBQSxHQUFPLGdCQUFnQixDQUFDLElBQUssQ0FBQSxDQUFBLENBQXBFO0FBQ0UsVUFBQSxJQUFDLENBQUEsVUFBRCxDQUFZLEdBQVosRUFBaUIsU0FBakIsQ0FBQSxDQURGO1NBSEY7T0FBQTthQU1BLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBWixHQUEyQixJQUFBLElBQUEsQ0FBQSxDQUFNLENBQUMsT0FBUCxDQUFBLEVBUDdCO0tBZmE7RUFBQSxDQWhCZixDQUFBOztBQUFBLDBDQXdDQSxTQUFBLEdBQVcsU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO0FBRVQsUUFBQSxtQkFBQTtBQUFBLElBQUEsOERBQUEsU0FBQSxDQUFBLENBQUE7QUFBQSxJQUVBLFNBQUEsR0FBWSxDQUFDLEVBQUEsR0FBSyxHQUFHLENBQUMsT0FBTyxDQUFDLFdBQWxCLENBQUEsR0FBaUMsQ0FBQSxDQUY3QyxDQUFBO0FBSUEsSUFBQSxJQUFHLFNBQVMsQ0FBQyxDQUFWLEdBQWMsU0FBZCxJQUE0QixDQUFBLEdBQU8sQ0FBQyxPQUFPLENBQUMsUUFBL0M7QUFDRSxNQUFBLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBWixHQUF1QixJQUF2QixDQUFBO0FBQ0EsWUFBQSxDQUZGO0tBSkE7QUFBQSxJQVFBLFFBQUEsR0FBVyxFQUFBLEdBQUssQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFdBQVosR0FBMEIsQ0FBM0IsQ0FSaEIsQ0FBQTtBQVVBLElBQUEsSUFBRyxTQUFTLENBQUMsQ0FBVixHQUFjLFFBQWQsSUFBMkIsR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUExQztBQUNFLE1BQUEsSUFBQyxDQUFBLFNBQUQsQ0FBVyxHQUFYLEVBQWdCLFNBQWhCLENBQUEsQ0FBQTthQUNBLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBWixHQUF1QixNQUZ6QjtLQVpTO0VBQUEsQ0F4Q1gsQ0FBQTs7QUFBQSwwQ0F3REEsVUFBQSxHQUFZLFNBQUMsR0FBRCxFQUFNLFNBQU4sR0FBQTtXQUNWLEdBQUcsQ0FBQyxPQUFKLENBQVksWUFBWixFQUEwQixTQUExQixFQURVO0VBQUEsQ0F4RFosQ0FBQTs7QUFBQSwwQ0EyREEsU0FBQSxHQUFXLFNBQUMsR0FBRCxFQUFNLFNBQU4sR0FBQTtXQUNULEdBQUcsQ0FBQyxPQUFKLENBQVksV0FBWixFQUF5QixTQUF6QixFQURTO0VBQUEsQ0EzRFgsQ0FBQTs7dUNBQUE7O0dBRDBDLDBCQXJLNUMsQ0FBQTs7QUFBQSxDQXFPQyxDQUFDLE1BQUYsQ0FBUyxPQUFULEVBQWtCO0FBQUEsRUFDaEIsTUFBQSxFQUFRLE1BRFE7QUFBQSxFQUVoQixZQUFBLEVBQWMsWUFGRTtBQUFBLEVBR2hCLGlCQUFBLEVBQW1CLGlCQUhIO0FBQUEsRUFJaEIseUJBQUEsRUFBMkIseUJBSlg7QUFBQSxFQUtoQiw2QkFBQSxFQUErQiw2QkFMZjtDQUFsQixDQXJPQSxDQUFBIiwiZmlsZSI6ImV2ZW50cy5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiXG5cbl8gPSByZXF1aXJlKCd1bmRlcnNjb3JlJylcblxuXG5jbGFzcyBTZXNzaW9uXG4gICMgU2Vzc2lvbiBjb25zdHJ1Y3RvclxuICAjIEBwYXJhbSB7U3RyaW5nfSBhcm0ge2xlZnR8cmlnaHR9XG4gICMgQHBhcmFtIHtTdHJpbmd9IGRpcmVjdGlvbiAjIG5vdCBzdXJlIGFib3V0IHRoaXMgb25lXG4gIGNvbnN0cnVjdG9yOiAoQGFybSwgQGRpcmVjdGlvbikgLT5cbiAgICBAcG9zZSA9IG51bGxcbiAgICBAbWVzc2FnZXNRdWV1ZSA9IFtdXG5cbiAgaW5pdGlhbGl6ZTogLT5cbiAgICAjIGhlcmUgSSB3YW50IHRvIGFkZCBhbiBpbml0aWFsaXphdGlvbiBvZiB0aGUgdXNlciBzZXNzaW9uIG9uIHRoZSBhcm1iYW5kLFxuICAgICMgcmVnaXN0ZXJpbmcgY29tbW9uIGFjdGlvbnMganVzdCB0byBrbm93IHRoZSB1c2VyIGJldHRlciBhbmQgYWRhcHQgdG8gaGlzXG4gICAgIyBoYWJpdHMgZXZlcnkgcGVyc29uIGhhcyBhIGRpZmZlcmVudCBzdHJlbmd0aCB3aGVuIHBlcmZvcm1pbmcgZGlmZmVyZW50XG4gICAgIyBhY3Rpb25zLCByZWdpc3RlcmluZyBjb21tb25nIGFjdGlvbnMgd2lsbCBtYWtlIGl0IGVhc2llciB0byBhZGFwdFxuICAgICMgYWN0aW9ucyBiYXNlZCBvbiB1c2VyJ3Mgc2Vuc2l0aXZpdHlcblxuICBjbG9zZTogLT5cbiAgICAjIGRvIHNvbWV0aGluZ1xuXG5cbmNsYXNzIFN1YnNjcmlwdGlvblxuICBjb25zdHJ1Y3RvcjogKEBjYWxsYmFjaywgQGluZGV4LCBAc3Vic2NyaXB0aW9uTGlzdCkgLT5cblxuICBpbnZva2U6IChhcmdzLi4uKS0+XG4gICAgQGNhbGxiYWNrKGFyZ3MuLi4pXG5cbiAgZGlzcG9zZTogLT5cbiAgICBAc3Vic2NyaXB0aW9uTGlzdC5zcGxpY2UoQGluZGV4LCAwKVxuXG5cbmNsYXNzIEV2ZW50c1xuICBjb25zdHJ1Y3RvcjogLT5cbiAgICBAZXZlbnRzID0ge31cblxuICBvbjogKGV2ZW50TmFtZSwgbGlzdGVuZXIpIC0+XG4gICAgaWYgbm90IEBldmVudHNbZXZlbnROYW1lXVxuICAgICAgQGV2ZW50c1tldmVudE5hbWVdID0gW10gICMgbmV3IHN1YnNjcmlwdGlvbiBsaXN0IGZvciB0aGlzIG5ldyBldmVudFxuXG4gICAgc3Vic2NyaXB0aW9uTGlzdCA9IEBldmVudHNbZXZlbnROYW1lXVxuICAgIHN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oXG4gICAgICBsaXN0ZW5lcixcbiAgICAgIHN1YnNjcmlwdGlvbkxpc3QubGVuZ3RoLFxuICAgICAgc3Vic2NyaXB0aW9uTGlzdFxuICAgIClcbiAgICBzdWJzY3JpcHRpb25MaXN0LnB1c2goc3Vic2NyaXB0aW9uKVxuICAgIHJldHVybiBzdWJzY3JpcHRpb25cblxuICB0cmlnZ2VyOiAoZXZlbnROYW1lLCBhcmdzLi4uKSAtPlxuICAgIHN1YnNjcmlwdGlvbkxpc3QgPSBAZXZlbnRzW2V2ZW50TmFtZV0gb3IgW11cbiAgICBsZW4gPSBzdWJzY3JpcHRpb25MaXN0Lmxlbmd0aFxuXG4gICAgd2hpbGUgbGVuLS1cbiAgICAgIHN1YnNjcmlwdGlvbiA9IHN1YnNjcmlwdGlvbkxpc3RbbGVuXVxuICAgICAgc3Vic2NyaXB0aW9uLmludm9rZShhcmdzLi4uKVxuXG4gIG9mZjogKGV2ZW50TmFtZSkgLT5cbiAgICAjIHRoaXMgY2FuIGJlIHVzZWQgdG8gcmVtb3ZlIGFsbCBzdWJzY3JpcHRpb25zIHRvIGEgc3BlY2lmaWMgZXZlbnQsIHRvXG4gICAgIyBkaXNwb3NlIHNpbmdsZSBzdWJzY3JpcHRpb24gdXNlIHRoZSBkaXNwb3NlIG1ldGhvZCBvbiB0aGVtXG4gICAgQGV2ZW50c1tldmVudE5hbWVdID0gW11cblxuXG5jbGFzcyBQcm94eUV2ZW50TWFuYWdlclxuICAjIFByZXBhcmVzIGV2ZW50IGFuZCBldmVudCBkYXRhIHRvIGJlIHByb3hpZWQgdG8gdGhlIG15byBpbnN0YW5jZVxuICAjIEl0J3MgYWxzbyByZXNwb25zaWJsZSB0byBjcmVhdGUgc2Vzc2lvbnMgYW5kIHVwZGF0ZSB0aGVtLCBvbiBteW8gaW5zdGFuY2VzXG4gICMgQnkgaW5oZXJpdGluZyBmcm9tIHRoaXMgY2xhc3MsIGl0IGlzIHBvc3NpYmxlIHRvIGV4dGVuZCB0aGUgbGlzdCBvZiBldmVudHNcbiAgIyBhIG15byBjYW4gcmVjb2duaXplXG4gIGhhbmRsZTogKG15bywgZXZlbnREYXRhKSAtPlxuICAgIEBpbml0U2Vzc2lvbihteW8sIGV2ZW50RGF0YSlcbiAgICBoYW5kbGVyID0gQGdldEhhbmRsZXIoZXZlbnREYXRhLnR5cGUpXG4gICAgaGFuZGxlci5jYWxsKEAsIG15bywgZXZlbnREYXRhKVxuXG4gIGluaXRTZXNzaW9uOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgaWYgbm90IG15by5zZXNzaW9uXG4gICAgICBteW8uc2Vzc2lvbiA9IG5ldyBTZXNzaW9uKGV2ZW50RGF0YS5hcm0sIGV2ZW50RGF0YS54X2RpcmVjdGlvbilcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIHJldHVybiB0cnVlXG5cbiAgcmVtb3ZlU2Vzc2lvbjogKG15bykgLT5cbiAgICBpZiBteW8uc2Vzc2lvblxuICAgICAgbXlvLnNlc3Npb24uY2xvc2UoKVxuXG4gICAgbXlvLnNlc3Npb24gPSBudWxsXG5cbiAgZ2V0SGFuZGxlcjogKGV2ZW50VHlwZSkgLT5cbiAgICByZXR1cm4gQFtldmVudFR5cGVdIG9yIEAuZGVmYXVsdFxuXG4gICMgaGFuZGxlcnNcbiAgYXJtX3JlY29nbml6ZWQ6IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICBteW8udHJpZ2dlcignYXJtX3JlY29nbml6ZWQnLCBldmVudERhdGEpXG5cbiAgYXJtX2xvc3Q6IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICBAcmVtb3ZlU2Vzc2lvbigpXG4gICAgbXlvLnRyaWdnZXIoJ2FybV9sb3N0JywgZXZlbnREYXRhKVxuXG4gIHBhaXJlZDogKG15bywgZXZlbnREYXRhKSAtPlxuICAgIG15by50cmlnZ2VyKCdwYWlyZWQnLCBldmVudERhdGEpXG5cbiAgcG9zZTogKG15bywgZXZlbnREYXRhKSAtPlxuICAgIG15by5zZXNzaW9uLnBvc2UgPSBldmVudERhdGEucG9zZVxuICAgIG15by50cmlnZ2VyKCdwb3NlJywgZXZlbnREYXRhLnBvc2UpXG5cbiAgb3JpZW50YXRpb246IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICBteW8udHJpZ2dlcignb3JpZW50YXRpb24nLCBldmVudERhdGEpXG5cbiAgcnNzaTogKG15bywgZXZlbnREYXRhKSAtPlxuICAgIG15by50cmlnZ2VyKCdibHVldG9vdGhfc3RyZW5ndGgnLCBldmVudERhdGEucnNzaSlcblxuICBjb25uZWN0ZWQ6IChteW8sIGV2ZW50RGF0YSkgLT5cbiMgICAgICBteW8uY29ubmVjdF92ZXJzaW9uID0gZGF0YS52ZXJzaW9uLmpvaW4oJy4nKVxuICAgIG15by50cmlnZ2VyKCdjb25uZWN0ZWQnLCBldmVudERhdGEpXG5cbiAgZGlzY29ubmVjdGVkOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgIyBkZXN0cm95IG15byBpbnN0YW5jZT9cbiAgICBAcmVtb3ZlU2Vzc2lvbigpXG4gICAgbXlvLnRyaWdnZXIoJ2Rpc2Nvbm5lY3RlZCcsIGV2ZW50RGF0YSlcblxuICBkZWZhdWx0OiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgY29uc29sZS5sb2coJ1VuaGFuZGxlZCBldmVudDonLCBldmVudERhdGEpXG5cblxuY2xhc3MgRXh0ZW5kZWRQcm94eUV2ZW50TWFuYWdlciBleHRlbmRzIFByb3h5RXZlbnRNYW5hZ2VyXG4gIG9yaWVudGF0aW9uOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgIyBjb21wbGV0ZWx5IG92ZXJyaWRlcyBwYXJlbnQncyBvcmllbnRhdGlvbiBtZXRob2RcbiAgICAjIGFkZCBhbiBvZmZzZXQgdG8gdGhlIG9yaWVudGF0aW9uIGRhdGE/XG4gICAgb3JpZW50YXRpb25EYXRhID0ge1xuICAgICAgeDogZXZlbnREYXRhLm9yaWVudGF0aW9uLnhcbiAgICAgIHk6IGV2ZW50RGF0YS5vcmllbnRhdGlvbi55XG4gICAgICB6OiBldmVudERhdGEub3JpZW50YXRpb24uelxuICAgICAgdzogZXZlbnREYXRhLm9yaWVudGF0aW9uLndcbiAgICB9XG4gICAgZ3lyb3Njb3BlRGF0YSA9IHtcbiAgICAgIHg6IGV2ZW50RGF0YS5neXJvc2NvcGVbMF1cbiAgICAgIHk6IGV2ZW50RGF0YS5neXJvc2NvcGVbMV1cbiAgICAgIHo6IGV2ZW50RGF0YS5neXJvc2NvcGVbMl1cbiAgICB9XG4gICAgYWNjZWxlcm9tZXRlckRhdGEgPSB7XG4gICAgICB4OiBldmVudERhdGEuYWNjZWxlcm9tZXRlclswXVxuICAgICAgeTogZXZlbnREYXRhLmFjY2VsZXJvbWV0ZXJbMV1cbiAgICAgIHo6IGV2ZW50RGF0YS5hY2NlbGVyb21ldGVyWzJdXG4gICAgfVxuICAgIGltdURhdGEgPSB7XG4gICAgICBneXJvc2NvcGU6IGd5cm9zY29wZURhdGFcbiAgICAgIGFjY2VsZXJvbWV0ZXI6IGFjY2VsZXJvbWV0ZXJEYXRhXG4gICAgICBvcmllbnRhdGlvbjogb3JpZW50YXRpb25EYXRhXG4gICAgfVxuICAgIG15by50cmlnZ2VyKCdvcmllbnRhdGlvbicsIG9yaWVudGF0aW9uRGF0YSlcblxuICAgIEBneXJvc2NvcGUobXlvLCBneXJvc2NvcGVEYXRhKVxuICAgIEBhY2NlbGVyb21ldGVyKG15bywgYWNjZWxlcm9tZXRlckRhdGEpXG4gICAgQGltdShteW8sIGltdURhdGEpXG5cbiAgZ3lyb3Njb3BlOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgbXlvLnRyaWdnZXIoJ2d5cm9zY29wZScsIGV2ZW50RGF0YSlcblxuICBhY2NlbGVyb21ldGVyOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgbXlvLnRyaWdnZXIoJ2FjY2VsZXJvbWV0ZXInLCBldmVudERhdGEpXG5cbiAgaW11OiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgbXlvLnRyaWdnZXIoJ2ltdScsIGV2ZW50RGF0YSlcblxuXG5jbGFzcyBFeHBlcmltZW50YWxQcm94eUV2ZW50TWFuYWdlciBleHRlbmRzIEV4dGVuZGVkUHJveHlFdmVudE1hbmFnZXJcbiAgaW5pdFNlc3Npb246IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICBoYWRTZXNzaW9uID0gc3VwZXJcblxuICAgIGlmIG5vdCBoYWRTZXNzaW9uXG4gICAgICBteW8uc2Vzc2lvbi53YXNSaWdodCA9IGZhbHNlXG4gICAgICBteW8uc2Vzc2lvbi5zZW5zaXRpdml0eSA9IDIwXG4gICAgICBteW8uc2Vzc2lvbi5sYXN0SU1VID0gbnVsbFxuICAgICAgbXlvLnNlc3Npb24uZG91YmxlVGFwID0ge1xuICAgICAgICB0aHJlc2hvbGQ6IDAuOVxuICAgICAgICB0aW1lOiBbODAsIDMwMF1cbiAgICAgIH1cblxuICBpbXU6IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICBteW8uc2Vzc2lvbi5sYXN0SU1VID0gZXZlbnREYXRhXG4gICAgc3VwZXJcblxuICBhY2NlbGVyb21ldGVyOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgIyBhZGQgZG91YmxlX3RhcCBldmVudFxuICAgICMgYWxsIHJpZ2h0cyBmb3IgdGhpcyBldmVudCBnbyB0byBzdG9sa3Nkb3JmICggaHR0cHM6Ly9naXRodWIuY29tL3N0b2xrc2RvcmYvbXlvLmpzLmdpdCApXG4gICAgc3VwZXJcblxuICAgIGlmIG5vdCBteW8uc2Vzc2lvbi5sYXN0SU1VXG4gICAgICByZXR1cm5cblxuICAgIGRvdWJsZVRhcE9wdGlvbnMgPSBteW8uc2Vzc2lvbi5kb3VibGVUYXBcbiAgICBsYXN0ID0gbXlvLnNlc3Npb24ubGFzdElNVS5hY2NlbGVyb21ldGVyXG5cbiAgICB5ID0gTWF0aC5hYnMoZXZlbnREYXRhLnkpXG4gICAgeiA9IE1hdGguYWJzKGV2ZW50RGF0YS56KVxuICAgIGRlbHRhID0gTWF0aC5hYnMoTWF0aC5hYnMobGFzdC55KSAtIHkpICsgTWF0aC5hYnMoTWF0aC5hYnMobGFzdC56KSAtIHopXG5cbiAgICBpZiBkZWx0YSA+IGRvdWJsZVRhcE9wdGlvbnMudGhyZXNob2xkXG4gICAgICBpZiBteW8uc2Vzc2lvbi5sYXN0X3RhcFxuICAgICAgICBkaWZmID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBteW8uc2Vzc2lvbi5sYXN0X3RhcFxuXG4gICAgICAgIGlmIGRpZmYgPiBkb3VibGVUYXBPcHRpb25zLnRpbWVbMF0gYW5kIGRpZmYgPCBkb3VibGVUYXBPcHRpb25zLnRpbWVbMV1cbiAgICAgICAgICBAZG91YmxlX3RhcChteW8sIGV2ZW50RGF0YSlcblxuICAgICAgbXlvLnNlc3Npb24ubGFzdF90YXAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuXG4gIGd5cm9zY29wZTogKG15bywgZXZlbnREYXRhKSAtPlxuICAgICMgYWRkIHNsYXBfbGVmdCBldmVudFxuICAgIHN1cGVyXG5cbiAgICBzZW5zUmlnaHQgPSAoMjAgKyBteW8uc2Vzc2lvbi5zZW5zaXRpdml0eSkgKiAtMVxuXG4gICAgaWYgZXZlbnREYXRhLnggPCBzZW5zUmlnaHQgYW5kIG5vdCBteW8uc2Vzc2lvbi53YXNSaWdodFxuICAgICAgbXlvLnNlc3Npb24ud2FzUmlnaHQgPSB0cnVlXG4gICAgICByZXR1cm5cblxuICAgIHNlbnNMZWZ0ID0gODAgKyAobXlvLnNlc3Npb24uc2Vuc2l0aXZpdHkgKiAyKVxuXG4gICAgaWYgZXZlbnREYXRhLnggPiBzZW5zTGVmdCBhbmQgbXlvLnNlc3Npb24ud2FzUmlnaHRcbiAgICAgIEBzbGFwX2xlZnQobXlvLCBldmVudERhdGEpXG4gICAgICBteW8uc2Vzc2lvbi53YXNSaWdodCA9IGZhbHNlXG5cbiAgZG91YmxlX3RhcDogKG15bywgZXZlbnREYXRhKSAtPlxuICAgIG15by50cmlnZ2VyKCdkb3VibGVfdGFwJywgZXZlbnREYXRhKVxuXG4gIHNsYXBfbGVmdDogKG15bywgZXZlbnREYXRhKSAtPlxuICAgIG15by50cmlnZ2VyKCdzbGFwX2xlZnQnLCBldmVudERhdGEpXG5cblxuXy5leHRlbmQoZXhwb3J0cywge1xuICBFdmVudHM6IEV2ZW50c1xuICBTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvblxuICBQcm94eUV2ZW50TWFuYWdlcjogUHJveHlFdmVudE1hbmFnZXJcbiAgRXh0ZW5kZWRQcm94eUV2ZW50TWFuYWdlcjogRXh0ZW5kZWRQcm94eUV2ZW50TWFuYWdlclxuICBFeHBlcmltZW50YWxQcm94eUV2ZW50TWFuYWdlcjogRXhwZXJpbWVudGFsUHJveHlFdmVudE1hbmFnZXJcbn0pXG4iXX0=