"use strict";
var Hub, Myo, Session, connection, events, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

_ = require('underscore');

events = require('./events');

connection = require('./connection');

Myo = (function(_super) {
  var defaultConfiguration, _id;

  __extends(Myo, _super);

  defaultConfiguration = {};

  _id = 0;

  function Myo(configuration) {
    Myo.__super__.constructor.apply(this, arguments);
    this.configuration = _.extend({}, Myo.defaultConfiguration, configuration);
    this.id = _id++;
    this.session = null;
  }

  Myo.prototype.destroy = function() {
    return this.trigger('destroy');
  };

  return Myo;

})(events.Events);

Session = (function() {
  function Session(myo, arm, direction) {
    this.myo = myo;
    this.arm = arm;
    this.direction = direction;
    this.pose = null;
    this.eventsQueue = [];
  }

  Session.prototype.initialize = function() {};

  return Session;

})();

Hub = (function() {
  function Hub(connection) {
    this.connection = connection;
    this.onMessage = __bind(this.onMessage, this);
    this.myos = {};
    this.onMessageSubscription = this.connection.on('message', this.onMessage);
  }

  Hub.prototype.onMessage = function(eventData) {
    var baseEventHandler, myo;
    myo = this.myos[eventData.myo];
    if (!myo) {
      throw new Error('Specified Myo not found');
    }
    baseEventHandler = this.baseEventHandlers[eventData.type];
    if (!baseEventHandler) {
      throw new Error('Event data type not recognized');
    }
    return baseEventHandler(myo, eventData);
  };

  Hub.prototype.create = function(configuration) {
    var newMyo;
    newMyo = new Myo(configuration);
    this.myos[newMyo.id] = newMyo;
    newMyo.on('destroy', (function(_this) {
      return function() {
        return _this.myos[newMyo.id] = null;
      };
    })(this));
    return newMyo;
  };

  Hub.prototype.destroy = function() {
    this.onMessageSubscription.dispose();
    return this.connection.close();
  };

  Hub.prototype.baseEventHandlers = {
    arm_recognized: function(myo, eventData) {
      if (myo.session) {
        myo.session.close();
      }
      myo.session = new Session(this, eventData.arm, eventData.x_direction);
      return myo.trigger(new events.Event('arm_recognized'));
    },
    arm_lost: function(myo, eventData) {
      if (myo.session) {
        myo.session.close();
      }
      myo.session = null;
      return myo.trigger(new events.Event('arm_lost'));
    },
    pose: function(myo, eventData) {
      if (!myo.session) {
        throw new Error('No session found');
      }
      myo.session.pose = eventData.pose;
      return myo.trigger(new events.Event('pose', eventData.pose));
    },
    orientation: function(myo, eventData) {
      var accelerometerData, gyroscopeData, imuData, orientationData;
      orientationData = {
        x: eventData.orientation.x,
        y: eventData.orientation.y,
        z: eventData.orientation.z,
        w: eventData.orientation.w
      };
      gyroscopeData = {
        x: eventData.gyroscope[0],
        y: eventData.gyroscope[1],
        z: eventData.gyroscope[2]
      };
      accelerometerData = {
        x: eventData.accelerometer[0],
        y: eventData.accelerometer[1],
        z: eventData.accelerometer[2]
      };
      imuData = {
        gyroscope: gyroscopeData,
        accelerometer: accelerometerData,
        orientation: orientationData
      };
      myo.trigger(new events.Event('orientation', orientationData));
      myo.trigger(new events.Event('gyroscope', gyroscopeData));
      myo.trigger(new events.Event('accelerometer', accelerometerData));
      return myo.trigger(new events.Event('imu', imuData));
    },
    rssi: function(myo, eventData) {
      return myo.trigger(new events.Event('bluetooth_strength', eventData.rssi));
    },
    connected: function(myo, eventData) {
      return myo.trigger(new events.Event('connected'));
    },
    disconnected: function(myo, eventData) {
      return myo.trigger(new events.Event('disconnected'));
    }
  };

  return Hub;

})();

_.extend(exports, {
  Hub: Hub,
  Myo: Myo
});

//# sourceMappingURL=data:application/json;base64,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QUFKLENBQWdCLElBQUEsTUFBTSxDQUFDLEtBQVAsQ0FBYSxjQUFiLENBQWhCLEVBRlk7SUFBQSxDQXpERztHQTlCbkIsQ0FBQTs7YUFBQTs7SUE3Q0YsQ0FBQTs7QUFBQSxDQXlJQyxDQUFDLE1BQUYsQ0FBUyxPQUFULEVBQWtCO0FBQUEsRUFDaEIsR0FBQSxFQUFLLEdBRFc7QUFBQSxFQUVoQixHQUFBLEVBQUssR0FGVztDQUFsQixDQXpJQSxDQUFBIiwiZmlsZSI6Im9sb3Jpbi5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiXG5cbl8gPSByZXF1aXJlKCd1bmRlcnNjb3JlJylcbmV2ZW50cyA9IHJlcXVpcmUoJy4vZXZlbnRzJylcbmNvbm5lY3Rpb24gPSByZXF1aXJlKCcuL2Nvbm5lY3Rpb24nKVxuXG5cbmNsYXNzIE15byBleHRlbmRzIGV2ZW50cy5FdmVudHNcbiAgZGVmYXVsdENvbmZpZ3VyYXRpb24gPSB7fVxuICBfaWQgPSAwXG5cbiAgIyBNeW8gY29uc3RydWN0b3JcbiAgIyBAcGFyYW0ge29iamVjdH0gY29uZmlndXJhdGlvblxuICBjb25zdHJ1Y3RvcjogKGNvbmZpZ3VyYXRpb24pIC0+XG4gICAgc3VwZXJcbiAgICBAY29uZmlndXJhdGlvbiA9IF8uZXh0ZW5kKHt9LCBNeW8uZGVmYXVsdENvbmZpZ3VyYXRpb24sIGNvbmZpZ3VyYXRpb24pXG4gICAgQGlkID0gX2lkKysgICMgbm90IHN1cmUgYWJvdXQgdGhpcyBvbmVcbiAgICBAc2Vzc2lvbiA9IG51bGxcblxuICBkZXN0cm95OiAoKSAtPlxuICAgIEB0cmlnZ2VyKCdkZXN0cm95JylcblxuXG5jbGFzcyBTZXNzaW9uXG4gICMgU2Vzc2lvbiBjb25zdHJ1Y3RvclxuICAjIEBwYXJhbSB7TXlvfSBteW9cbiAgIyBAcGFyYW0ge1N0cmluZ30gYXJtIHtsZWZ0fHJpZ2h0fVxuICAjIEBwYXJhbSB7U3RyaW5nfSBkaXJlY3Rpb24gIyBub3Qgc3VyZSBhYm91dCB0aGlzIG9uZVxuICBjb25zdHJ1Y3RvcjogKEBteW8sIEBhcm0sIEBkaXJlY3Rpb24pIC0+XG4gICAgQHBvc2UgPSBudWxsXG4gICAgQGV2ZW50c1F1ZXVlID0gW11cblxuICBpbml0aWFsaXplOiAoKSAtPlxuICAgICMgaGVyZSBJIHdhbnQgdG8gYWRkIGFuIGluaXRpYWxpemF0aW9uIG9mIHRoZSB1c2VyIHNlc3Npb24gb24gdGhlIGFybWJhbmQsXG4gICAgIyByZWdpc3RlcmluZyBjb21tb24gYWN0aW9ucyBqdXN0IHRvIGtub3cgdGhlIHVzZXIgYmV0dGVyIGFuZCBhZGFwdCB0byBoaXNcbiAgICAjIGhhYml0cyBldmVyeSBwZXJzb24gaGFzIGEgZGlmZmVyZW50IHN0cmVuZ3RoIHdoZW4gcGVyZm9ybWluZyBkaWZmZXJlbnRcbiAgICAjIGFjdGlvbnMsIHJlZ2lzdGVyaW5nIGNvbW1vbmcgYWN0aW9ucyB3aWxsIG1ha2UgaXQgZWFzaWVyIHRvIGFkYXB0XG4gICAgIyBhY3Rpb25zIGJhc2VkIG9uIHVzZXIncyBzZW5zaXRpdml0eVxuXG5cbmNsYXNzIEh1YlxuICAjIEh1YiBjb25zdHJ1Y3RvclxuICAjIEFuIGh1YiBpcyByZXNwb25zaWJsZSB0byBrZWVwIHRyYWNrIG9mIGFsbCB0aGUgbXlvcyBjcmVhdGVkIGFuZCB0byBkZWxpdmVyXG4gICMgbWVzc2FnZXMgdG8gdGhlIGNvcnJlY3QgbXlvXG4gICMgQHBhcmFtIHtDb25uZWN0aW9ufSBjb25uZWN0aW9uXG4gIGNvbnN0cnVjdG9yOiAoQGNvbm5lY3Rpb24pIC0+XG4gICAgQG15b3MgPSB7fVxuICAgIEBvbk1lc3NhZ2VTdWJzY3JpcHRpb24gPSBAY29ubmVjdGlvbi5vbignbWVzc2FnZScsIEBvbk1lc3NhZ2UpXG5cbiAgb25NZXNzYWdlOiAoZXZlbnREYXRhKSA9PlxuICAgIG15byA9IEBteW9zW2V2ZW50RGF0YS5teW9dXG5cbiAgICBpZiAhbXlvXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NwZWNpZmllZCBNeW8gbm90IGZvdW5kJylcblxuICAgIGJhc2VFdmVudEhhbmRsZXIgPSBAYmFzZUV2ZW50SGFuZGxlcnNbZXZlbnREYXRhLnR5cGVdXG5cbiAgICBpZiAhYmFzZUV2ZW50SGFuZGxlclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFdmVudCBkYXRhIHR5cGUgbm90IHJlY29nbml6ZWQnKVxuXG4gICAgYmFzZUV2ZW50SGFuZGxlcihteW8sIGV2ZW50RGF0YSlcblxuICBjcmVhdGU6IChjb25maWd1cmF0aW9uKSAtPlxuICAgIG5ld015byA9IG5ldyBNeW8oY29uZmlndXJhdGlvbilcbiAgICBAbXlvc1tuZXdNeW8uaWRdID0gbmV3TXlvXG5cbiAgICBuZXdNeW8ub24oJ2Rlc3Ryb3knLCA9PlxuICAgICAgQG15b3NbbmV3TXlvLmlkXSA9IG51bGxcbiAgICApXG4gICAgcmV0dXJuIG5ld015b1xuXG4gIGRlc3Ryb3k6ICgpIC0+XG4gICAgQG9uTWVzc2FnZVN1YnNjcmlwdGlvbi5kaXNwb3NlKClcbiAgICBAY29ubmVjdGlvbi5jbG9zZSgpICMgbm90IHN1cmUgYWJvdXQgdGhhdFxuXG4gIGJhc2VFdmVudEhhbmRsZXJzOiB7XG4gICAgYXJtX3JlY29nbml6ZWQ6IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICAgIGlmIG15by5zZXNzaW9uXG4gICAgICAgIG15by5zZXNzaW9uLmNsb3NlKClcblxuICAgICAgbXlvLnNlc3Npb24gPSBuZXcgU2Vzc2lvbihALCBldmVudERhdGEuYXJtLCBldmVudERhdGEueF9kaXJlY3Rpb24pXG4gICAgICBteW8udHJpZ2dlcihuZXcgZXZlbnRzLkV2ZW50KCdhcm1fcmVjb2duaXplZCcpKVxuXG4gICAgYXJtX2xvc3Q6IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICAgIGlmIG15by5zZXNzaW9uXG4gICAgICAgIG15by5zZXNzaW9uLmNsb3NlKClcblxuICAgICAgbXlvLnNlc3Npb24gPSBudWxsXG4gICAgICBteW8udHJpZ2dlcihuZXcgZXZlbnRzLkV2ZW50KCdhcm1fbG9zdCcpKVxuXG4gICAgcG9zZTogKG15bywgZXZlbnREYXRhKSAtPlxuICAgICAgaWYgbm90IG15by5zZXNzaW9uXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gc2Vzc2lvbiBmb3VuZCcpXG5cbiAgICAgIG15by5zZXNzaW9uLnBvc2UgPSBldmVudERhdGEucG9zZVxuICAgICAgbXlvLnRyaWdnZXIobmV3IGV2ZW50cy5FdmVudCgncG9zZScsIGV2ZW50RGF0YS5wb3NlKSlcblxuICAgIG9yaWVudGF0aW9uOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgICAjIGFkZCBhbiBvZmZzZXQgdG8gdGhlIG9yaWVudGF0aW9uIGRhdGE/XG4gICAgICBvcmllbnRhdGlvbkRhdGEgPSB7XG4gICAgICAgIHg6IGV2ZW50RGF0YS5vcmllbnRhdGlvbi54XG4gICAgICAgIHk6IGV2ZW50RGF0YS5vcmllbnRhdGlvbi55XG4gICAgICAgIHo6IGV2ZW50RGF0YS5vcmllbnRhdGlvbi56XG4gICAgICAgIHc6IGV2ZW50RGF0YS5vcmllbnRhdGlvbi53XG4gICAgICB9XG4gICAgICBneXJvc2NvcGVEYXRhID0ge1xuICAgICAgICB4OiBldmVudERhdGEuZ3lyb3Njb3BlWzBdXG4gICAgICAgIHk6IGV2ZW50RGF0YS5neXJvc2NvcGVbMV1cbiAgICAgICAgejogZXZlbnREYXRhLmd5cm9zY29wZVsyXVxuICAgICAgfVxuICAgICAgYWNjZWxlcm9tZXRlckRhdGEgPSB7XG4gICAgICAgIHg6IGV2ZW50RGF0YS5hY2NlbGVyb21ldGVyWzBdXG4gICAgICAgIHk6IGV2ZW50RGF0YS5hY2NlbGVyb21ldGVyWzFdXG4gICAgICAgIHo6IGV2ZW50RGF0YS5hY2NlbGVyb21ldGVyWzJdXG4gICAgICB9XG4gICAgICBpbXVEYXRhID0ge1xuICAgICAgICBneXJvc2NvcGU6IGd5cm9zY29wZURhdGFcbiAgICAgICAgYWNjZWxlcm9tZXRlcjogYWNjZWxlcm9tZXRlckRhdGFcbiAgICAgICAgb3JpZW50YXRpb246IG9yaWVudGF0aW9uRGF0YVxuICAgICAgfVxuICAgICAgbXlvLnRyaWdnZXIobmV3IGV2ZW50cy5FdmVudCgnb3JpZW50YXRpb24nLCBvcmllbnRhdGlvbkRhdGEpKVxuICAgICAgbXlvLnRyaWdnZXIobmV3IGV2ZW50cy5FdmVudCgnZ3lyb3Njb3BlJywgZ3lyb3Njb3BlRGF0YSkpXG4gICAgICBteW8udHJpZ2dlcihuZXcgZXZlbnRzLkV2ZW50KCdhY2NlbGVyb21ldGVyJywgYWNjZWxlcm9tZXRlckRhdGEpKVxuICAgICAgbXlvLnRyaWdnZXIobmV3IGV2ZW50cy5FdmVudCgnaW11JywgaW11RGF0YSkpXG5cbiAgICByc3NpOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgICBteW8udHJpZ2dlcihuZXcgZXZlbnRzLkV2ZW50KCdibHVldG9vdGhfc3RyZW5ndGgnLCBldmVudERhdGEucnNzaSkpXG5cbiAgICBjb25uZWN0ZWQ6IChteW8sIGV2ZW50RGF0YSkgLT5cbiMgICAgICBteW8uY29ubmVjdF92ZXJzaW9uID0gZGF0YS52ZXJzaW9uLmpvaW4oJy4nKVxuICAgICAgbXlvLnRyaWdnZXIobmV3IGV2ZW50cy5FdmVudCgnY29ubmVjdGVkJykpXG5cbiAgICBkaXNjb25uZWN0ZWQ6IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICAgICMgZGVzdHJ5IG15byBpbnN0YW5jZT9cbiAgICAgIG15by50cmlnZ2VyKG5ldyBldmVudHMuRXZlbnQoJ2Rpc2Nvbm5lY3RlZCcpKVxuICB9XG5cbl8uZXh0ZW5kKGV4cG9ydHMsIHtcbiAgSHViOiBIdWJcbiAgTXlvOiBNeW9cbn0pXG4iXX0=