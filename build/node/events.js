"use strict";
var Events, ExperimentalProxyEventManager, ExtendedProxyEventManager, MessageQueue, ProxyEventManager, Session, Subscription, _,
  __slice = [].slice,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('underscore');

MessageQueue = (function() {
  function MessageQueue(limit) {
    this.limit = limit != null ? limit : 1000;
    this.queue = [];
  }

  MessageQueue.prototype.purge = function() {
    if (this.queue.length > this.limit) {
      return this.queue.splice(this.limit, this.queue.length - this.limit);
    }
  };

  MessageQueue.prototype.push = function(object) {
    this.purge();
    return this.queue.push(object);
  };

  MessageQueue.prototype.getLastItems = function(length) {
    if (length == null) {
      length = 100;
    }
    return this.queue.slice(0, length);
  };

  return MessageQueue;

})();

Session = (function() {
  function Session(messageQueueLimit) {
    this.messageQueueLimit = messageQueueLimit;
    this.pose = null;
    this.messagesQueue = new MessageQueue(this.messageQueueLimit);
    this.arm = this.direction = this.version = this.connectedTimestamp = this.armRecognizedTimestamp = null;
    this.extra = {};
  }

  Session.prototype.initialize = function() {};

  Session.prototype.onConnected = function(version, connectedTimestamp) {
    this.connectedTimestamp = connectedTimestamp;
    return this.version = version.join('.');
  };

  Session.prototype.onArmRecognized = function(arm, direction, armRecognizedTimestamp) {
    this.arm = arm;
    this.direction = direction;
    this.armRecognizedTimestamp = armRecognizedTimestamp;
  };

  Session.prototype.close = function() {};

  return Session;

})();

Subscription = (function() {
  function Subscription(callback, index, subscriptionList) {
    this.callback = callback;
    this.index = index;
    this.subscriptionList = subscriptionList;
  }

  Subscription.prototype.invoke = function() {
    var args;
    args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
    return this.callback.apply(this, args);
  };

  Subscription.prototype.dispose = function() {
    return this.subscriptionList.splice(this.index, 0);
  };

  return Subscription;

})();

Events = (function() {
  function Events() {
    this.events = {};
  }

  Events.prototype.on = function(eventName, listener) {
    var subscription, subscriptionList;
    if (!this.events[eventName]) {
      this.events[eventName] = [];
    }
    subscriptionList = this.events[eventName];
    subscription = new Subscription(listener, subscriptionList.length, subscriptionList);
    subscriptionList.push(subscription);
    return subscription;
  };

  Events.prototype.once = function(eventName, listener) {
    var subscription;
    subscription = this.on(eventName, function() {
      var args;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      subscription.dispose();
      return listener.apply(null, args);
    });
    return subscription;
  };

  Events.prototype.trigger = function() {
    var args, eventName, len, subscription, subscriptionList, _results;
    eventName = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
    subscriptionList = this.events[eventName] || [];
    len = subscriptionList.length;
    _results = [];
    while (len--) {
      subscription = subscriptionList[len];
      _results.push(subscription.invoke.apply(subscription, args));
    }
    return _results;
  };

  Events.prototype.off = function(eventName) {
    return this.events[eventName] = [];
  };

  return Events;

})();

ProxyEventManager = (function() {
  function ProxyEventManager(debounceTriggerBy) {
    this.debounceTriggerBy = debounceTriggerBy != null ? debounceTriggerBy : 1000;
  }

  ProxyEventManager.prototype.handle = function(myo, eventData) {
    var handler;
    this.initSession(myo, eventData);
    myo.session.messagesQueue.push(eventData);
    handler = this.getHandler(eventData.type);
    return handler.call(this, myo, eventData);
  };

  ProxyEventManager.prototype.initSession = function(myo, eventData) {
    if (!myo.session) {
      myo.session = new Session();
      return false;
    }
    return true;
  };

  ProxyEventManager.prototype.removeSession = function(myo) {
    if (myo.session) {
      myo.session.close();
    }
    return myo.session = null;
  };

  ProxyEventManager.prototype.getHandler = function(eventType) {
    return this[eventType] || this["default"];
  };

  ProxyEventManager.prototype.trigger = function(myo, eventData) {
    var canTriggerAgain, currentTime, extra, _ref;
    currentTime = (new Date()).getTime();
    extra = (_ref = myo.session) != null ? _ref.extra : void 0;
    if (!extra || extra.lastDebounce === null) {
      canTriggerAgain = true;
    } else {
      canTriggerAgain = currentTime > (extra.lastDebounce + this.debounceTriggerBy);
    }
    console.log('canTriggerAgain', canTriggerAgain);
    if (canTriggerAgain) {
      extra.lastDebounce = currentTime;
      return myo.trigger(eventData);
    }
  };

  ProxyEventManager.prototype.arm_recognized = function(myo, eventData) {
    myo.session.onArmRecognized(eventData.arm, eventData.x_direction, eventData.timestamp);
    return this.trigger(myo, 'arm_recognized', eventData);
  };

  ProxyEventManager.prototype.arm_lost = function(myo, eventData) {
    this.removeSession(myo);
    return this.trigger(myo, 'arm_lost', eventData);
  };

  ProxyEventManager.prototype.paired = function(myo, eventData) {
    return this.trigger(myo, 'paired', eventData);
  };

  ProxyEventManager.prototype.pose = function(myo, eventData) {
    myo.session.pose = eventData.pose;
    return this.trigger(myo, 'pose', eventData.pose);
  };

  ProxyEventManager.prototype.orientation = function(myo, eventData) {
    return this.trigger(myo, 'orientation', eventData);
  };

  ProxyEventManager.prototype.rssi = function(myo, eventData) {
    return this.trigger(myo, 'bluetooth_strength', eventData.rssi);
  };

  ProxyEventManager.prototype.connected = function(myo, eventData) {
    myo.session.onConnected(eventData.version, eventData.timestamp);
    return this.trigger(myo, 'connected', eventData);
  };

  ProxyEventManager.prototype.disconnected = function(myo, eventData) {
    this.removeSession(myo);
    return this.trigger(myo, 'disconnected', eventData);
  };

  ProxyEventManager.prototype["default"] = function(myo, eventData) {
    return console.log('Unhandled event:', eventData);
  };

  return ProxyEventManager;

})();

ExtendedProxyEventManager = (function(_super) {
  __extends(ExtendedProxyEventManager, _super);

  function ExtendedProxyEventManager() {
    return ExtendedProxyEventManager.__super__.constructor.apply(this, arguments);
  }

  ExtendedProxyEventManager.prototype.orientation = function(myo, eventData) {
    var accelerometerData, gyroscopeData, imuData, orientationData, state;
    state = myo.session.extra;
    orientationData = {
      x: eventData.orientation.x - state.zeroOrientationOffset.x,
      y: eventData.orientation.y - state.zeroOrientationOffset.y,
      z: eventData.orientation.z - state.zeroOrientationOffset.z,
      w: eventData.orientation.w - state.zeroOrientationOffset.w
    };
    gyroscopeData = {
      x: eventData.gyroscope[0],
      y: eventData.gyroscope[1],
      z: eventData.gyroscope[2]
    };
    accelerometerData = {
      x: eventData.accelerometer[0],
      y: eventData.accelerometer[1],
      z: eventData.accelerometer[2]
    };
    imuData = {
      gyroscope: gyroscopeData,
      accelerometer: accelerometerData,
      orientation: orientationData
    };
    state.lastOrientationData = orientationData;
    ExtendedProxyEventManager.__super__.orientation.call(this, myo, orientationData);
    this.gyroscope(myo, gyroscopeData);
    this.accelerometer(myo, accelerometerData);
    return this.imu(myo, imuData);
  };

  ExtendedProxyEventManager.prototype.gyroscope = function(myo, eventData) {
    return this.trigger(myo, 'gyroscope', eventData);
  };

  ExtendedProxyEventManager.prototype.accelerometer = function(myo, eventData) {
    return this.trigger(myo, 'accelerometer', eventData);
  };

  ExtendedProxyEventManager.prototype.imu = function(myo, eventData) {
    return this.trigger(myo, 'imu', eventData);
  };

  return ExtendedProxyEventManager;

})(ProxyEventManager);

ExperimentalProxyEventManager = (function(_super) {
  __extends(ExperimentalProxyEventManager, _super);

  function ExperimentalProxyEventManager() {
    return ExperimentalProxyEventManager.__super__.constructor.apply(this, arguments);
  }

  ExperimentalProxyEventManager.prototype.initSession = function(myo) {
    var hadSession;
    hadSession = ExperimentalProxyEventManager.__super__.initSession.apply(this, arguments);
    if (!hadSession) {
      return _.extend(myo.session.extra, {
        wasRight: false,
        sensitivity: 20,
        lastIMU: null,
        doubleTap: {
          threshold: 0.9,
          time: [80, 300]
        },
        zeroOrientationOffset: {
          x: 0,
          y: 0,
          z: 0,
          w: 0
        }
      });
    }
  };

  ExperimentalProxyEventManager.prototype.accelerometer = function(myo, eventData) {
    var delta, diff, doubleTapOptions, last, state, y, z;
    ExperimentalProxyEventManager.__super__.accelerometer.apply(this, arguments);
    state = myo.session.extra;
    if (!state.lastIMU) {
      return;
    }
    doubleTapOptions = state.doubleTap;
    last = state.lastIMU.accelerometer;
    y = Math.abs(eventData.y);
    z = Math.abs(eventData.z);
    delta = Math.abs(Math.abs(last.y) - y) + Math.abs(Math.abs(last.z) - z);
    if (delta > doubleTapOptions.threshold) {
      if (state.last_tap) {
        diff = new Date().getTime() - state.last_tap;
        if (diff > doubleTapOptions.time[0] && diff < doubleTapOptions.time[1]) {
          this.double_tap(myo, eventData);
        }
      }
      return state.last_tap = new Date().getTime();
    }
  };

  ExperimentalProxyEventManager.prototype.imu = function(myo, eventData) {
    var sensLeft, sensRight, state;
    myo.session.extra.lastIMU = eventData;
    ExperimentalProxyEventManager.__super__.imu.apply(this, arguments);
    eventData = eventData.orientation;
    state = myo.session.extra;
    sensRight = (20 + state.sensitivity) * -1;
    if (eventData.x < sensRight && !state.wasRight) {
      state.wasRight = true;
      return;
    }
    sensLeft = 80 + (state.sensitivity * 2);
    if (eventData.x > sensLeft && state.wasRight) {
      this.slap_left(myo, eventData);
      return state.wasRight = false;
    }
  };

  ExperimentalProxyEventManager.prototype.slap_left = function(myo, eventData) {
    return this.trigger(myo, 'slap_left', eventData);
  };

  ExperimentalProxyEventManager.prototype.double_tap = function(myo, eventData) {
    this.trigger(myo, 'double_tap', eventData);
    return myo.zeroOrientation();
  };

  return ExperimentalProxyEventManager;

})(ExtendedProxyEventManager);

_.extend(exports, {
  Events: Events,
  Subscription: Subscription,
  ProxyEventManager: ProxyEventManager,
  ExtendedProxyEventManager: ExtendedProxyEventManager,
  ExperimentalProxyEventManager: ExperimentalProxyEventManager
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV2ZW50cy5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBQSxDQUFBO0FBQUEsSUFBQSwySEFBQTtFQUFBOztpU0FBQTs7QUFBQSxDQUVBLEdBQUksT0FBQSxDQUFRLFlBQVIsQ0FGSixDQUFBOztBQUFBO0FBTWUsRUFBQSxzQkFBRSxLQUFGLEdBQUE7QUFDWCxJQURZLElBQUMsQ0FBQSx3QkFBQSxRQUFNLElBQ25CLENBQUE7QUFBQSxJQUFBLElBQUMsQ0FBQSxLQUFELEdBQVMsRUFBVCxDQURXO0VBQUEsQ0FBYjs7QUFBQSx5QkFHQSxLQUFBLEdBQU8sU0FBQSxHQUFBO0FBQ0wsSUFBQSxJQUFHLElBQUMsQ0FBQSxLQUFLLENBQUMsTUFBUCxHQUFnQixJQUFDLENBQUEsS0FBcEI7YUFDRSxJQUFDLENBQUEsS0FBSyxDQUFDLE1BQVAsQ0FBYyxJQUFDLENBQUEsS0FBZixFQUFzQixJQUFDLENBQUEsS0FBSyxDQUFDLE1BQVAsR0FBZ0IsSUFBQyxDQUFBLEtBQXZDLEVBREY7S0FESztFQUFBLENBSFAsQ0FBQTs7QUFBQSx5QkFPQSxJQUFBLEdBQU0sU0FBQyxNQUFELEdBQUE7QUFDSixJQUFBLElBQUMsQ0FBQSxLQUFELENBQUEsQ0FBQSxDQUFBO0FBQ0EsV0FBTyxJQUFDLENBQUEsS0FBSyxDQUFDLElBQVAsQ0FBWSxNQUFaLENBQVAsQ0FGSTtFQUFBLENBUE4sQ0FBQTs7QUFBQSx5QkFXQSxZQUFBLEdBQWMsU0FBQyxNQUFELEdBQUE7O01BQUMsU0FBTztLQUNwQjtBQUFBLFdBQU8sSUFBQyxDQUFBLEtBQUssQ0FBQyxLQUFQLENBQWEsQ0FBYixFQUFnQixNQUFoQixDQUFQLENBRFk7RUFBQSxDQVhkLENBQUE7O3NCQUFBOztJQU5GLENBQUE7O0FBQUE7QUF5QmUsRUFBQSxpQkFBRSxpQkFBRixHQUFBO0FBQ1gsSUFEWSxJQUFDLENBQUEsb0JBQUEsaUJBQ2IsQ0FBQTtBQUFBLElBQUEsSUFBQyxDQUFBLElBQUQsR0FBUSxJQUFSLENBQUE7QUFBQSxJQUNBLElBQUMsQ0FBQSxhQUFELEdBQXFCLElBQUEsWUFBQSxDQUFhLElBQUMsQ0FBQSxpQkFBZCxDQURyQixDQUFBO0FBQUEsSUFFQSxJQUFDLENBQUEsR0FBRCxHQUFPLElBQUMsQ0FBQSxTQUFELEdBQWEsSUFBQyxDQUFBLE9BQUQsR0FBVyxJQUFDLENBQUEsa0JBQUQsR0FBc0IsSUFBQyxDQUFBLHNCQUFELEdBQTBCLElBRi9FLENBQUE7QUFBQSxJQUtBLElBQUMsQ0FBQSxLQUFELEdBQVMsRUFMVCxDQURXO0VBQUEsQ0FBYjs7QUFBQSxvQkFRQSxVQUFBLEdBQVksU0FBQSxHQUFBLENBUlosQ0FBQTs7QUFBQSxvQkFlQSxXQUFBLEdBQWEsU0FBQyxPQUFELEVBQVcsa0JBQVgsR0FBQTtBQUNYLElBRHFCLElBQUMsQ0FBQSxxQkFBQSxrQkFDdEIsQ0FBQTtXQUFBLElBQUMsQ0FBQSxPQUFELEdBQVcsT0FBTyxDQUFDLElBQVIsQ0FBYSxHQUFiLEVBREE7RUFBQSxDQWZiLENBQUE7O0FBQUEsb0JBa0JBLGVBQUEsR0FBaUIsU0FBRSxHQUFGLEVBQVEsU0FBUixFQUFvQixzQkFBcEIsR0FBQTtBQUE2QyxJQUE1QyxJQUFDLENBQUEsTUFBQSxHQUEyQyxDQUFBO0FBQUEsSUFBdEMsSUFBQyxDQUFBLFlBQUEsU0FBcUMsQ0FBQTtBQUFBLElBQTFCLElBQUMsQ0FBQSx5QkFBQSxzQkFBeUIsQ0FBN0M7RUFBQSxDQWxCakIsQ0FBQTs7QUFBQSxvQkFvQkEsS0FBQSxHQUFPLFNBQUEsR0FBQSxDQXBCUCxDQUFBOztpQkFBQTs7SUF6QkYsQ0FBQTs7QUFBQTtBQWtEZSxFQUFBLHNCQUFFLFFBQUYsRUFBYSxLQUFiLEVBQXFCLGdCQUFyQixHQUFBO0FBQXdDLElBQXZDLElBQUMsQ0FBQSxXQUFBLFFBQXNDLENBQUE7QUFBQSxJQUE1QixJQUFDLENBQUEsUUFBQSxLQUEyQixDQUFBO0FBQUEsSUFBcEIsSUFBQyxDQUFBLG1CQUFBLGdCQUFtQixDQUF4QztFQUFBLENBQWI7O0FBQUEseUJBRUEsTUFBQSxHQUFRLFNBQUEsR0FBQTtBQUNOLFFBQUEsSUFBQTtBQUFBLElBRE8sOERBQ1AsQ0FBQTtXQUFBLElBQUMsQ0FBQSxRQUFELGFBQVUsSUFBVixFQURNO0VBQUEsQ0FGUixDQUFBOztBQUFBLHlCQUtBLE9BQUEsR0FBUyxTQUFBLEdBQUE7V0FDUCxJQUFDLENBQUEsZ0JBQWdCLENBQUMsTUFBbEIsQ0FBeUIsSUFBQyxDQUFBLEtBQTFCLEVBQWlDLENBQWpDLEVBRE87RUFBQSxDQUxULENBQUE7O3NCQUFBOztJQWxERixDQUFBOztBQUFBO0FBNERlLEVBQUEsZ0JBQUEsR0FBQTtBQUNYLElBQUEsSUFBQyxDQUFBLE1BQUQsR0FBVSxFQUFWLENBRFc7RUFBQSxDQUFiOztBQUFBLG1CQUdBLEVBQUEsR0FBSSxTQUFDLFNBQUQsRUFBWSxRQUFaLEdBQUE7QUFDRixRQUFBLDhCQUFBO0FBQUEsSUFBQSxJQUFHLENBQUEsSUFBSyxDQUFBLE1BQU8sQ0FBQSxTQUFBLENBQWY7QUFDRSxNQUFBLElBQUMsQ0FBQSxNQUFPLENBQUEsU0FBQSxDQUFSLEdBQXFCLEVBQXJCLENBREY7S0FBQTtBQUFBLElBR0EsZ0JBQUEsR0FBbUIsSUFBQyxDQUFBLE1BQU8sQ0FBQSxTQUFBLENBSDNCLENBQUE7QUFBQSxJQUlBLFlBQUEsR0FBbUIsSUFBQSxZQUFBLENBQ2pCLFFBRGlCLEVBRWpCLGdCQUFnQixDQUFDLE1BRkEsRUFHakIsZ0JBSGlCLENBSm5CLENBQUE7QUFBQSxJQVNBLGdCQUFnQixDQUFDLElBQWpCLENBQXNCLFlBQXRCLENBVEEsQ0FBQTtBQVVBLFdBQU8sWUFBUCxDQVhFO0VBQUEsQ0FISixDQUFBOztBQUFBLG1CQWdCQSxJQUFBLEdBQU0sU0FBQyxTQUFELEVBQVksUUFBWixHQUFBO0FBQ0osUUFBQSxZQUFBO0FBQUEsSUFBQSxZQUFBLEdBQWUsSUFBQyxDQUFBLEVBQUQsQ0FBSSxTQUFKLEVBQWUsU0FBQSxHQUFBO0FBQzVCLFVBQUEsSUFBQTtBQUFBLE1BRDZCLDhEQUM3QixDQUFBO0FBQUEsTUFBQSxZQUFZLENBQUMsT0FBYixDQUFBLENBQUEsQ0FBQTthQUNBLFFBQUEsYUFBUyxJQUFULEVBRjRCO0lBQUEsQ0FBZixDQUFmLENBQUE7QUFJQSxXQUFPLFlBQVAsQ0FMSTtFQUFBLENBaEJOLENBQUE7O0FBQUEsbUJBdUJBLE9BQUEsR0FBUyxTQUFBLEdBQUE7QUFDUCxRQUFBLDhEQUFBO0FBQUEsSUFEUSwwQkFBVyw4REFDbkIsQ0FBQTtBQUFBLElBQUEsZ0JBQUEsR0FBbUIsSUFBQyxDQUFBLE1BQU8sQ0FBQSxTQUFBLENBQVIsSUFBc0IsRUFBekMsQ0FBQTtBQUFBLElBQ0EsR0FBQSxHQUFNLGdCQUFnQixDQUFDLE1BRHZCLENBQUE7QUFHQTtXQUFNLEdBQUEsRUFBTixHQUFBO0FBQ0UsTUFBQSxZQUFBLEdBQWUsZ0JBQWlCLENBQUEsR0FBQSxDQUFoQyxDQUFBO0FBQUEsb0JBQ0EsWUFBWSxDQUFDLE1BQWIscUJBQW9CLElBQXBCLEVBREEsQ0FERjtJQUFBLENBQUE7b0JBSk87RUFBQSxDQXZCVCxDQUFBOztBQUFBLG1CQStCQSxHQUFBLEdBQUssU0FBQyxTQUFELEdBQUE7V0FHSCxJQUFDLENBQUEsTUFBTyxDQUFBLFNBQUEsQ0FBUixHQUFxQixHQUhsQjtFQUFBLENBL0JMLENBQUE7O2dCQUFBOztJQTVERixDQUFBOztBQUFBO0FBc0dlLEVBQUEsMkJBQUUsaUJBQUYsR0FBQTtBQUEyQixJQUExQixJQUFDLENBQUEsZ0RBQUEsb0JBQWtCLElBQU8sQ0FBM0I7RUFBQSxDQUFiOztBQUFBLDhCQUVBLE1BQUEsR0FBUSxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7QUFDTixRQUFBLE9BQUE7QUFBQSxJQUFBLElBQUMsQ0FBQSxXQUFELENBQWEsR0FBYixFQUFrQixTQUFsQixDQUFBLENBQUE7QUFBQSxJQUNBLEdBQUcsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLElBQTFCLENBQStCLFNBQS9CLENBREEsQ0FBQTtBQUFBLElBRUEsT0FBQSxHQUFVLElBQUMsQ0FBQSxVQUFELENBQVksU0FBUyxDQUFDLElBQXRCLENBRlYsQ0FBQTtXQUdBLE9BQU8sQ0FBQyxJQUFSLENBQWEsSUFBYixFQUFnQixHQUFoQixFQUFxQixTQUFyQixFQUpNO0VBQUEsQ0FGUixDQUFBOztBQUFBLDhCQVFBLFdBQUEsR0FBYSxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7QUFDWCxJQUFBLElBQUcsQ0FBQSxHQUFPLENBQUMsT0FBWDtBQUNFLE1BQUEsR0FBRyxDQUFDLE9BQUosR0FBa0IsSUFBQSxPQUFBLENBQUEsQ0FBbEIsQ0FBQTtBQUNBLGFBQU8sS0FBUCxDQUZGO0tBQUE7QUFHQSxXQUFPLElBQVAsQ0FKVztFQUFBLENBUmIsQ0FBQTs7QUFBQSw4QkFjQSxhQUFBLEdBQWUsU0FBQyxHQUFELEdBQUE7QUFDYixJQUFBLElBQUcsR0FBRyxDQUFDLE9BQVA7QUFDRSxNQUFBLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBWixDQUFBLENBQUEsQ0FERjtLQUFBO1dBR0EsR0FBRyxDQUFDLE9BQUosR0FBYyxLQUpEO0VBQUEsQ0FkZixDQUFBOztBQUFBLDhCQW9CQSxVQUFBLEdBQVksU0FBQyxTQUFELEdBQUE7QUFDVixXQUFPLElBQUUsQ0FBQSxTQUFBLENBQUYsSUFBZ0IsSUFBQyxDQUFDLFNBQUQsQ0FBeEIsQ0FEVTtFQUFBLENBcEJaLENBQUE7O0FBQUEsOEJBdUJBLE9BQUEsR0FBUyxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7QUFDUCxRQUFBLHlDQUFBO0FBQUEsSUFBQSxXQUFBLEdBQWMsQ0FBSyxJQUFBLElBQUEsQ0FBQSxDQUFMLENBQVksQ0FBQyxPQUFiLENBQUEsQ0FBZCxDQUFBO0FBQUEsSUFDQSxLQUFBLHNDQUFtQixDQUFFLGNBRHJCLENBQUE7QUFHQSxJQUFBLElBQUcsQ0FBQSxLQUFBLElBQWEsS0FBSyxDQUFDLFlBQU4sS0FBc0IsSUFBdEM7QUFDRSxNQUFBLGVBQUEsR0FBa0IsSUFBbEIsQ0FERjtLQUFBLE1BQUE7QUFHRSxNQUFBLGVBQUEsR0FBa0IsV0FBQSxHQUFjLENBQUMsS0FBSyxDQUFDLFlBQU4sR0FBcUIsSUFBQyxDQUFBLGlCQUF2QixDQUFoQyxDQUhGO0tBSEE7QUFBQSxJQVFBLE9BQU8sQ0FBQyxHQUFSLENBQVksaUJBQVosRUFBK0IsZUFBL0IsQ0FSQSxDQUFBO0FBVUEsSUFBQSxJQUFHLGVBQUg7QUFDRSxNQUFBLEtBQUssQ0FBQyxZQUFOLEdBQXFCLFdBQXJCLENBQUE7YUFDQSxHQUFHLENBQUMsT0FBSixDQUFZLFNBQVosRUFGRjtLQVhPO0VBQUEsQ0F2QlQsQ0FBQTs7QUFBQSw4QkF1Q0EsY0FBQSxHQUFnQixTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7QUFDZCxJQUFBLEdBQUcsQ0FBQyxPQUFPLENBQUMsZUFBWixDQUE0QixTQUFTLENBQUMsR0FBdEMsRUFBMkMsU0FBUyxDQUFDLFdBQXJELEVBQWtFLFNBQVMsQ0FBQyxTQUE1RSxDQUFBLENBQUE7V0FDQSxJQUFDLENBQUEsT0FBRCxDQUFTLEdBQVQsRUFBYyxnQkFBZCxFQUFnQyxTQUFoQyxFQUZjO0VBQUEsQ0F2Q2hCLENBQUE7O0FBQUEsOEJBMkNBLFFBQUEsR0FBVSxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7QUFDUixJQUFBLElBQUMsQ0FBQSxhQUFELENBQWUsR0FBZixDQUFBLENBQUE7V0FDQSxJQUFDLENBQUEsT0FBRCxDQUFTLEdBQVQsRUFBYyxVQUFkLEVBQTBCLFNBQTFCLEVBRlE7RUFBQSxDQTNDVixDQUFBOztBQUFBLDhCQStDQSxNQUFBLEdBQVEsU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO1dBQ04sSUFBQyxDQUFBLE9BQUQsQ0FBUyxHQUFULEVBQWMsUUFBZCxFQUF3QixTQUF4QixFQURNO0VBQUEsQ0EvQ1IsQ0FBQTs7QUFBQSw4QkFrREEsSUFBQSxHQUFNLFNBQUMsR0FBRCxFQUFNLFNBQU4sR0FBQTtBQUNKLElBQUEsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFaLEdBQW1CLFNBQVMsQ0FBQyxJQUE3QixDQUFBO1dBQ0EsSUFBQyxDQUFBLE9BQUQsQ0FBUyxHQUFULEVBQWMsTUFBZCxFQUFzQixTQUFTLENBQUMsSUFBaEMsRUFGSTtFQUFBLENBbEROLENBQUE7O0FBQUEsOEJBc0RBLFdBQUEsR0FBYSxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7V0FDWCxJQUFDLENBQUEsT0FBRCxDQUFTLEdBQVQsRUFBYyxhQUFkLEVBQTZCLFNBQTdCLEVBRFc7RUFBQSxDQXREYixDQUFBOztBQUFBLDhCQXlEQSxJQUFBLEdBQU0sU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO1dBQ0osSUFBQyxDQUFBLE9BQUQsQ0FBUyxHQUFULEVBQWMsb0JBQWQsRUFBb0MsU0FBUyxDQUFDLElBQTlDLEVBREk7RUFBQSxDQXpETixDQUFBOztBQUFBLDhCQTREQSxTQUFBLEdBQVcsU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO0FBQ1QsSUFBQSxHQUFHLENBQUMsT0FBTyxDQUFDLFdBQVosQ0FBd0IsU0FBUyxDQUFDLE9BQWxDLEVBQTJDLFNBQVMsQ0FBQyxTQUFyRCxDQUFBLENBQUE7V0FDQSxJQUFDLENBQUEsT0FBRCxDQUFTLEdBQVQsRUFBYyxXQUFkLEVBQTJCLFNBQTNCLEVBRlM7RUFBQSxDQTVEWCxDQUFBOztBQUFBLDhCQWdFQSxZQUFBLEdBQWMsU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO0FBRVosSUFBQSxJQUFDLENBQUEsYUFBRCxDQUFlLEdBQWYsQ0FBQSxDQUFBO1dBQ0EsSUFBQyxDQUFBLE9BQUQsQ0FBUyxHQUFULEVBQWMsY0FBZCxFQUE4QixTQUE5QixFQUhZO0VBQUEsQ0FoRWQsQ0FBQTs7QUFBQSw4QkFxRUEsVUFBQSxHQUFTLFNBQUMsR0FBRCxFQUFNLFNBQU4sR0FBQTtXQUNQLE9BQU8sQ0FBQyxHQUFSLENBQVksa0JBQVosRUFBZ0MsU0FBaEMsRUFETztFQUFBLENBckVULENBQUE7OzJCQUFBOztJQXRHRixDQUFBOztBQUFBO0FBZ0xFLDhDQUFBLENBQUE7Ozs7R0FBQTs7QUFBQSxzQ0FBQSxXQUFBLEdBQWEsU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO0FBR1gsUUFBQSxpRUFBQTtBQUFBLElBQUEsS0FBQSxHQUFRLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBcEIsQ0FBQTtBQUFBLElBQ0EsZUFBQSxHQUFrQjtBQUFBLE1BQ2hCLENBQUEsRUFBRyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQXRCLEdBQTBCLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUR6QztBQUFBLE1BRWhCLENBQUEsRUFBRyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQXRCLEdBQTBCLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUZ6QztBQUFBLE1BR2hCLENBQUEsRUFBRyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQXRCLEdBQTBCLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUh6QztBQUFBLE1BSWhCLENBQUEsRUFBRyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQXRCLEdBQTBCLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUp6QztLQURsQixDQUFBO0FBQUEsSUFPQSxhQUFBLEdBQWdCO0FBQUEsTUFDZCxDQUFBLEVBQUcsU0FBUyxDQUFDLFNBQVUsQ0FBQSxDQUFBLENBRFQ7QUFBQSxNQUVkLENBQUEsRUFBRyxTQUFTLENBQUMsU0FBVSxDQUFBLENBQUEsQ0FGVDtBQUFBLE1BR2QsQ0FBQSxFQUFHLFNBQVMsQ0FBQyxTQUFVLENBQUEsQ0FBQSxDQUhUO0tBUGhCLENBQUE7QUFBQSxJQVlBLGlCQUFBLEdBQW9CO0FBQUEsTUFDbEIsQ0FBQSxFQUFHLFNBQVMsQ0FBQyxhQUFjLENBQUEsQ0FBQSxDQURUO0FBQUEsTUFFbEIsQ0FBQSxFQUFHLFNBQVMsQ0FBQyxhQUFjLENBQUEsQ0FBQSxDQUZUO0FBQUEsTUFHbEIsQ0FBQSxFQUFHLFNBQVMsQ0FBQyxhQUFjLENBQUEsQ0FBQSxDQUhUO0tBWnBCLENBQUE7QUFBQSxJQWlCQSxPQUFBLEdBQVU7QUFBQSxNQUNSLFNBQUEsRUFBVyxhQURIO0FBQUEsTUFFUixhQUFBLEVBQWUsaUJBRlA7QUFBQSxNQUdSLFdBQUEsRUFBYSxlQUhMO0tBakJWLENBQUE7QUFBQSxJQXNCQSxLQUFLLENBQUMsbUJBQU4sR0FBNEIsZUF0QjVCLENBQUE7QUFBQSxJQXdCQSwyREFBTSxHQUFOLEVBQVcsZUFBWCxDQXhCQSxDQUFBO0FBQUEsSUF5QkEsSUFBQyxDQUFBLFNBQUQsQ0FBVyxHQUFYLEVBQWdCLGFBQWhCLENBekJBLENBQUE7QUFBQSxJQTBCQSxJQUFDLENBQUEsYUFBRCxDQUFlLEdBQWYsRUFBb0IsaUJBQXBCLENBMUJBLENBQUE7V0EyQkEsSUFBQyxDQUFBLEdBQUQsQ0FBSyxHQUFMLEVBQVUsT0FBVixFQTlCVztFQUFBLENBQWIsQ0FBQTs7QUFBQSxzQ0FnQ0EsU0FBQSxHQUFXLFNBQUMsR0FBRCxFQUFNLFNBQU4sR0FBQTtXQUNULElBQUMsQ0FBQSxPQUFELENBQVMsR0FBVCxFQUFjLFdBQWQsRUFBMkIsU0FBM0IsRUFEUztFQUFBLENBaENYLENBQUE7O0FBQUEsc0NBbUNBLGFBQUEsR0FBZSxTQUFDLEdBQUQsRUFBTSxTQUFOLEdBQUE7V0FDYixJQUFDLENBQUEsT0FBRCxDQUFTLEdBQVQsRUFBYyxlQUFkLEVBQStCLFNBQS9CLEVBRGE7RUFBQSxDQW5DZixDQUFBOztBQUFBLHNDQXNDQSxHQUFBLEdBQUssU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO1dBQ0gsSUFBQyxDQUFBLE9BQUQsQ0FBUyxHQUFULEVBQWMsS0FBZCxFQUFxQixTQUFyQixFQURHO0VBQUEsQ0F0Q0wsQ0FBQTs7bUNBQUE7O0dBRHNDLGtCQS9LeEMsQ0FBQTs7QUFBQTtBQTJORSxrREFBQSxDQUFBOzs7O0dBQUE7O0FBQUEsMENBQUEsV0FBQSxHQUFhLFNBQUMsR0FBRCxHQUFBO0FBQ1gsUUFBQSxVQUFBO0FBQUEsSUFBQSxVQUFBLEdBQWEsZ0VBQUEsU0FBQSxDQUFiLENBQUE7QUFFQSxJQUFBLElBQUcsQ0FBQSxVQUFIO2FBQ0UsQ0FBQyxDQUFDLE1BQUYsQ0FBUyxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQXJCLEVBQTRCO0FBQUEsUUFDMUIsUUFBQSxFQUFVLEtBRGdCO0FBQUEsUUFFMUIsV0FBQSxFQUFhLEVBRmE7QUFBQSxRQUcxQixPQUFBLEVBQVMsSUFIaUI7QUFBQSxRQUkxQixTQUFBLEVBQVc7QUFBQSxVQUNULFNBQUEsRUFBVyxHQURGO0FBQUEsVUFFVCxJQUFBLEVBQU0sQ0FBQyxFQUFELEVBQUssR0FBTCxDQUZHO1NBSmU7QUFBQSxRQVExQixxQkFBQSxFQUF1QjtBQUFBLFVBQUMsQ0FBQSxFQUFHLENBQUo7QUFBQSxVQUFPLENBQUEsRUFBRyxDQUFWO0FBQUEsVUFBYSxDQUFBLEVBQUcsQ0FBaEI7QUFBQSxVQUFtQixDQUFBLEVBQUcsQ0FBdEI7U0FSRztPQUE1QixFQURGO0tBSFc7RUFBQSxDQUFiLENBQUE7O0FBQUEsMENBZUEsYUFBQSxHQUFlLFNBQUMsR0FBRCxFQUFNLFNBQU4sR0FBQTtBQUdiLFFBQUEsZ0RBQUE7QUFBQSxJQUFBLGtFQUFBLFNBQUEsQ0FBQSxDQUFBO0FBQUEsSUFFQSxLQUFBLEdBQVEsR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUZwQixDQUFBO0FBSUEsSUFBQSxJQUFHLENBQUEsS0FBUyxDQUFDLE9BQWI7QUFDRSxZQUFBLENBREY7S0FKQTtBQUFBLElBT0EsZ0JBQUEsR0FBbUIsS0FBSyxDQUFDLFNBUHpCLENBQUE7QUFBQSxJQVFBLElBQUEsR0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLGFBUnJCLENBQUE7QUFBQSxJQVVBLENBQUEsR0FBSSxJQUFJLENBQUMsR0FBTCxDQUFTLFNBQVMsQ0FBQyxDQUFuQixDQVZKLENBQUE7QUFBQSxJQVdBLENBQUEsR0FBSSxJQUFJLENBQUMsR0FBTCxDQUFTLFNBQVMsQ0FBQyxDQUFuQixDQVhKLENBQUE7QUFBQSxJQVlBLEtBQUEsR0FBUSxJQUFJLENBQUMsR0FBTCxDQUFTLElBQUksQ0FBQyxHQUFMLENBQVMsSUFBSSxDQUFDLENBQWQsQ0FBQSxHQUFtQixDQUE1QixDQUFBLEdBQWlDLElBQUksQ0FBQyxHQUFMLENBQVMsSUFBSSxDQUFDLEdBQUwsQ0FBUyxJQUFJLENBQUMsQ0FBZCxDQUFBLEdBQW1CLENBQTVCLENBWnpDLENBQUE7QUFjQSxJQUFBLElBQUcsS0FBQSxHQUFRLGdCQUFnQixDQUFDLFNBQTVCO0FBQ0UsTUFBQSxJQUFHLEtBQUssQ0FBQyxRQUFUO0FBQ0UsUUFBQSxJQUFBLEdBQVcsSUFBQSxJQUFBLENBQUEsQ0FBTSxDQUFDLE9BQVAsQ0FBQSxDQUFKLEdBQXVCLEtBQUssQ0FBQyxRQUFwQyxDQUFBO0FBRUEsUUFBQSxJQUFHLElBQUEsR0FBTyxnQkFBZ0IsQ0FBQyxJQUFLLENBQUEsQ0FBQSxDQUE3QixJQUFvQyxJQUFBLEdBQU8sZ0JBQWdCLENBQUMsSUFBSyxDQUFBLENBQUEsQ0FBcEU7QUFFRSxVQUFBLElBQUMsQ0FBQSxVQUFELENBQVksR0FBWixFQUFpQixTQUFqQixDQUFBLENBRkY7U0FIRjtPQUFBO2FBT0EsS0FBSyxDQUFDLFFBQU4sR0FBcUIsSUFBQSxJQUFBLENBQUEsQ0FBTSxDQUFDLE9BQVAsQ0FBQSxFQVJ2QjtLQWpCYTtFQUFBLENBZmYsQ0FBQTs7QUFBQSwwQ0EwQ0EsR0FBQSxHQUFLLFNBQUMsR0FBRCxFQUFNLFNBQU4sR0FBQTtBQUVILFFBQUEsMEJBQUE7QUFBQSxJQUFBLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLE9BQWxCLEdBQTRCLFNBQTVCLENBQUE7QUFBQSxJQUNBLHdEQUFBLFNBQUEsQ0FEQSxDQUFBO0FBQUEsSUFFQSxTQUFBLEdBQVksU0FBUyxDQUFDLFdBRnRCLENBQUE7QUFBQSxJQUlBLEtBQUEsR0FBUSxHQUFHLENBQUMsT0FBTyxDQUFDLEtBSnBCLENBQUE7QUFBQSxJQUtBLFNBQUEsR0FBWSxDQUFDLEVBQUEsR0FBSyxLQUFLLENBQUMsV0FBWixDQUFBLEdBQTJCLENBQUEsQ0FMdkMsQ0FBQTtBQU9BLElBQUEsSUFBRyxTQUFTLENBQUMsQ0FBVixHQUFjLFNBQWQsSUFBNEIsQ0FBQSxLQUFTLENBQUMsUUFBekM7QUFDRSxNQUFBLEtBQUssQ0FBQyxRQUFOLEdBQWlCLElBQWpCLENBQUE7QUFDQSxZQUFBLENBRkY7S0FQQTtBQUFBLElBV0EsUUFBQSxHQUFXLEVBQUEsR0FBSyxDQUFDLEtBQUssQ0FBQyxXQUFOLEdBQW9CLENBQXJCLENBWGhCLENBQUE7QUFhQSxJQUFBLElBQUcsU0FBUyxDQUFDLENBQVYsR0FBYyxRQUFkLElBQTJCLEtBQUssQ0FBQyxRQUFwQztBQUVFLE1BQUEsSUFBQyxDQUFBLFNBQUQsQ0FBVyxHQUFYLEVBQWdCLFNBQWhCLENBQUEsQ0FBQTthQUNBLEtBQUssQ0FBQyxRQUFOLEdBQWlCLE1BSG5CO0tBZkc7RUFBQSxDQTFDTCxDQUFBOztBQUFBLDBDQThEQSxTQUFBLEdBQVcsU0FBQyxHQUFELEVBQU0sU0FBTixHQUFBO1dBQ1QsSUFBQyxDQUFBLE9BQUQsQ0FBUyxHQUFULEVBQWMsV0FBZCxFQUEyQixTQUEzQixFQURTO0VBQUEsQ0E5RFgsQ0FBQTs7QUFBQSwwQ0FpRUEsVUFBQSxHQUFZLFNBQUMsR0FBRCxFQUFNLFNBQU4sR0FBQTtBQUNWLElBQUEsSUFBQyxDQUFBLE9BQUQsQ0FBUyxHQUFULEVBQWMsWUFBZCxFQUE0QixTQUE1QixDQUFBLENBQUE7V0FHQSxHQUFHLENBQUMsZUFBSixDQUFBLEVBSlU7RUFBQSxDQWpFWixDQUFBOzt1Q0FBQTs7R0FEMEMsMEJBMU41QyxDQUFBOztBQUFBLENBbVNDLENBQUMsTUFBRixDQUFTLE9BQVQsRUFBa0I7QUFBQSxFQUNoQixNQUFBLEVBQVEsTUFEUTtBQUFBLEVBRWhCLFlBQUEsRUFBYyxZQUZFO0FBQUEsRUFHaEIsaUJBQUEsRUFBbUIsaUJBSEg7QUFBQSxFQUloQix5QkFBQSxFQUEyQix5QkFKWDtBQUFBLEVBS2hCLDZCQUFBLEVBQStCLDZCQUxmO0NBQWxCLENBblNBLENBQUEiLCJmaWxlIjoiZXZlbnRzLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCJcblxuXyA9IHJlcXVpcmUoJ3VuZGVyc2NvcmUnKVxuXG5cbmNsYXNzIE1lc3NhZ2VRdWV1ZVxuICBjb25zdHJ1Y3RvcjogKEBsaW1pdD0xMDAwKS0+XG4gICAgQHF1ZXVlID0gW11cblxuICBwdXJnZTogLT5cbiAgICBpZiBAcXVldWUubGVuZ3RoID4gQGxpbWl0XG4gICAgICBAcXVldWUuc3BsaWNlKEBsaW1pdCwgQHF1ZXVlLmxlbmd0aCAtIEBsaW1pdClcblxuICBwdXNoOiAob2JqZWN0KSAtPlxuICAgIEBwdXJnZSgpXG4gICAgcmV0dXJuIEBxdWV1ZS5wdXNoKG9iamVjdClcblxuICBnZXRMYXN0SXRlbXM6IChsZW5ndGg9MTAwKSAtPlxuICAgIHJldHVybiBAcXVldWUuc2xpY2UoMCwgbGVuZ3RoKVxuXG5cbmNsYXNzIFNlc3Npb25cbiAgIyBTZXNzaW9uIGNvbnN0cnVjdG9yXG4gICMgQHBhcmFtIHtTdHJpbmd9IGFybSB7bGVmdHxyaWdodH1cbiAgIyBAcGFyYW0ge1N0cmluZ30gZGlyZWN0aW9uICMgbm90IHN1cmUgYWJvdXQgdGhpcyBvbmVcbiAgY29uc3RydWN0b3I6IChAbWVzc2FnZVF1ZXVlTGltaXQpIC0+XG4gICAgQHBvc2UgPSBudWxsXG4gICAgQG1lc3NhZ2VzUXVldWUgPSBuZXcgTWVzc2FnZVF1ZXVlKEBtZXNzYWdlUXVldWVMaW1pdClcbiAgICBAYXJtID0gQGRpcmVjdGlvbiA9IEB2ZXJzaW9uID0gQGNvbm5lY3RlZFRpbWVzdGFtcCA9IEBhcm1SZWNvZ25pemVkVGltZXN0YW1wID0gbnVsbFxuXG4gICAgIyB0aGlzIG9iamVjdCBjYW4gYmUgdXNlZCBieSBjdXN0b20gZXZlbnRzIHRvIHN0b3JlIGFkZGl0aW9uYWwgZGF0YVxuICAgIEBleHRyYSA9IHt9XG5cbiAgaW5pdGlhbGl6ZTogLT5cbiAgICAjIGhlcmUgSSB3YW50IHRvIGFkZCBhbiBpbml0aWFsaXphdGlvbiBvZiB0aGUgdXNlciBzZXNzaW9uIG9uIHRoZSBhcm1iYW5kLFxuICAgICMgcmVnaXN0ZXJpbmcgY29tbW9uIGFjdGlvbnMganVzdCB0byBrbm93IHRoZSB1c2VyIGJldHRlciBhbmQgYWRhcHQgdG8gaGlzXG4gICAgIyBoYWJpdHMgZXZlcnkgcGVyc29uIGhhcyBhIGRpZmZlcmVudCBzdHJlbmd0aCB3aGVuIHBlcmZvcm1pbmcgZGlmZmVyZW50XG4gICAgIyBhY3Rpb25zLCByZWdpc3RlcmluZyBjb21tb25nIGFjdGlvbnMgd2lsbCBtYWtlIGl0IGVhc2llciB0byBhZGFwdFxuICAgICMgYWN0aW9ucyBiYXNlZCBvbiB1c2VyJ3Mgc2Vuc2l0aXZpdHlcblxuICBvbkNvbm5lY3RlZDogKHZlcnNpb24sIEBjb25uZWN0ZWRUaW1lc3RhbXApIC0+XG4gICAgQHZlcnNpb24gPSB2ZXJzaW9uLmpvaW4oJy4nKVxuXG4gIG9uQXJtUmVjb2duaXplZDogKEBhcm0sIEBkaXJlY3Rpb24sIEBhcm1SZWNvZ25pemVkVGltZXN0YW1wKSAtPlxuXG4gIGNsb3NlOiAtPlxuICAgICMgZG8gc29tZXRoaW5nPyBlbXB0eSB0aGUgbWVzc2FnZSBxdWV1ZT9cblxuXG5jbGFzcyBTdWJzY3JpcHRpb25cbiAgY29uc3RydWN0b3I6IChAY2FsbGJhY2ssIEBpbmRleCwgQHN1YnNjcmlwdGlvbkxpc3QpIC0+XG5cbiAgaW52b2tlOiAoYXJncy4uLiktPlxuICAgIEBjYWxsYmFjayhhcmdzLi4uKVxuXG4gIGRpc3Bvc2U6IC0+XG4gICAgQHN1YnNjcmlwdGlvbkxpc3Quc3BsaWNlKEBpbmRleCwgMClcblxuXG5jbGFzcyBFdmVudHNcbiAgY29uc3RydWN0b3I6IC0+XG4gICAgQGV2ZW50cyA9IHt9XG5cbiAgb246IChldmVudE5hbWUsIGxpc3RlbmVyKSAtPlxuICAgIGlmIG5vdCBAZXZlbnRzW2V2ZW50TmFtZV1cbiAgICAgIEBldmVudHNbZXZlbnROYW1lXSA9IFtdICAjIG5ldyBzdWJzY3JpcHRpb24gbGlzdCBmb3IgdGhpcyBuZXcgZXZlbnRcblxuICAgIHN1YnNjcmlwdGlvbkxpc3QgPSBAZXZlbnRzW2V2ZW50TmFtZV1cbiAgICBzdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKFxuICAgICAgbGlzdGVuZXIsXG4gICAgICBzdWJzY3JpcHRpb25MaXN0Lmxlbmd0aCxcbiAgICAgIHN1YnNjcmlwdGlvbkxpc3RcbiAgICApXG4gICAgc3Vic2NyaXB0aW9uTGlzdC5wdXNoKHN1YnNjcmlwdGlvbilcbiAgICByZXR1cm4gc3Vic2NyaXB0aW9uXG5cbiAgb25jZTogKGV2ZW50TmFtZSwgbGlzdGVuZXIpIC0+XG4gICAgc3Vic2NyaXB0aW9uID0gQG9uKGV2ZW50TmFtZSwgKGFyZ3MuLi4pLT5cbiAgICAgIHN1YnNjcmlwdGlvbi5kaXNwb3NlKClcbiAgICAgIGxpc3RlbmVyKGFyZ3MuLi4pXG4gICAgKVxuICAgIHJldHVybiBzdWJzY3JpcHRpb25cblxuICB0cmlnZ2VyOiAoZXZlbnROYW1lLCBhcmdzLi4uKSAtPlxuICAgIHN1YnNjcmlwdGlvbkxpc3QgPSBAZXZlbnRzW2V2ZW50TmFtZV0gb3IgW11cbiAgICBsZW4gPSBzdWJzY3JpcHRpb25MaXN0Lmxlbmd0aFxuXG4gICAgd2hpbGUgbGVuLS1cbiAgICAgIHN1YnNjcmlwdGlvbiA9IHN1YnNjcmlwdGlvbkxpc3RbbGVuXVxuICAgICAgc3Vic2NyaXB0aW9uLmludm9rZShhcmdzLi4uKVxuXG4gIG9mZjogKGV2ZW50TmFtZSkgLT5cbiAgICAjIHRoaXMgY2FuIGJlIHVzZWQgdG8gcmVtb3ZlIGFsbCBzdWJzY3JpcHRpb25zIHRvIGEgc3BlY2lmaWMgZXZlbnQsIHRvXG4gICAgIyBkaXNwb3NlIHNpbmdsZSBzdWJzY3JpcHRpb24gdXNlIHRoZSBkaXNwb3NlIG1ldGhvZCBvbiB0aGVtXG4gICAgQGV2ZW50c1tldmVudE5hbWVdID0gW11cblxuXG5jbGFzcyBQcm94eUV2ZW50TWFuYWdlclxuICAjIFByZXBhcmVzIGV2ZW50IGFuZCBldmVudCBkYXRhIHRvIGJlIHByb3hpZWQgdG8gdGhlIG15byBpbnN0YW5jZVxuICAjIEl0J3MgYWxzbyByZXNwb25zaWJsZSB0byBjcmVhdGUgc2Vzc2lvbnMgYW5kIHVwZGF0ZSB0aGVtLCBvbiBteW8gaW5zdGFuY2VzXG4gICMgQnkgaW5oZXJpdGluZyBmcm9tIHRoaXMgY2xhc3MsIGl0IGlzIHBvc3NpYmxlIHRvIGV4dGVuZCB0aGUgbGlzdCBvZiBldmVudHNcbiAgIyBhIG15byBjYW4gcmVjb2duaXplXG4gIGNvbnN0cnVjdG9yOiAoQGRlYm91bmNlVHJpZ2dlckJ5PTEwMDApIC0+XG5cbiAgaGFuZGxlOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgQGluaXRTZXNzaW9uKG15bywgZXZlbnREYXRhKVxuICAgIG15by5zZXNzaW9uLm1lc3NhZ2VzUXVldWUucHVzaChldmVudERhdGEpXG4gICAgaGFuZGxlciA9IEBnZXRIYW5kbGVyKGV2ZW50RGF0YS50eXBlKVxuICAgIGhhbmRsZXIuY2FsbChALCBteW8sIGV2ZW50RGF0YSlcblxuICBpbml0U2Vzc2lvbjogKG15bywgZXZlbnREYXRhKSAtPlxuICAgIGlmIG5vdCBteW8uc2Vzc2lvblxuICAgICAgbXlvLnNlc3Npb24gPSBuZXcgU2Vzc2lvbigpXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICByZXR1cm4gdHJ1ZVxuXG4gIHJlbW92ZVNlc3Npb246IChteW8pIC0+XG4gICAgaWYgbXlvLnNlc3Npb25cbiAgICAgIG15by5zZXNzaW9uLmNsb3NlKClcblxuICAgIG15by5zZXNzaW9uID0gbnVsbFxuXG4gIGdldEhhbmRsZXI6IChldmVudFR5cGUpIC0+XG4gICAgcmV0dXJuIEBbZXZlbnRUeXBlXSBvciBALmRlZmF1bHRcblxuICB0cmlnZ2VyOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgY3VycmVudFRpbWUgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpXG4gICAgZXh0cmEgPSBteW8uc2Vzc2lvbj8uZXh0cmFcblxuICAgIGlmIG5vdCBleHRyYSBvciBleHRyYS5sYXN0RGVib3VuY2UgPT0gbnVsbFxuICAgICAgY2FuVHJpZ2dlckFnYWluID0gdHJ1ZVxuICAgIGVsc2VcbiAgICAgIGNhblRyaWdnZXJBZ2FpbiA9IGN1cnJlbnRUaW1lID4gKGV4dHJhLmxhc3REZWJvdW5jZSArIEBkZWJvdW5jZVRyaWdnZXJCeSlcblxuICAgIGNvbnNvbGUubG9nKCdjYW5UcmlnZ2VyQWdhaW4nLCBjYW5UcmlnZ2VyQWdhaW4pXG5cbiAgICBpZiBjYW5UcmlnZ2VyQWdhaW5cbiAgICAgIGV4dHJhLmxhc3REZWJvdW5jZSA9IGN1cnJlbnRUaW1lXG4gICAgICBteW8udHJpZ2dlcihldmVudERhdGEpXG5cbiAgIyBoYW5kbGVyc1xuICBhcm1fcmVjb2duaXplZDogKG15bywgZXZlbnREYXRhKSAtPlxuICAgIG15by5zZXNzaW9uLm9uQXJtUmVjb2duaXplZChldmVudERhdGEuYXJtLCBldmVudERhdGEueF9kaXJlY3Rpb24sIGV2ZW50RGF0YS50aW1lc3RhbXApXG4gICAgQHRyaWdnZXIobXlvLCAnYXJtX3JlY29nbml6ZWQnLCBldmVudERhdGEpXG5cbiAgYXJtX2xvc3Q6IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICBAcmVtb3ZlU2Vzc2lvbihteW8pXG4gICAgQHRyaWdnZXIobXlvLCAnYXJtX2xvc3QnLCBldmVudERhdGEpXG5cbiAgcGFpcmVkOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgQHRyaWdnZXIobXlvLCAncGFpcmVkJywgZXZlbnREYXRhKVxuXG4gIHBvc2U6IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICBteW8uc2Vzc2lvbi5wb3NlID0gZXZlbnREYXRhLnBvc2VcbiAgICBAdHJpZ2dlcihteW8sICdwb3NlJywgZXZlbnREYXRhLnBvc2UpXG5cbiAgb3JpZW50YXRpb246IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICBAdHJpZ2dlcihteW8sICdvcmllbnRhdGlvbicsIGV2ZW50RGF0YSlcblxuICByc3NpOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgQHRyaWdnZXIobXlvLCAnYmx1ZXRvb3RoX3N0cmVuZ3RoJywgZXZlbnREYXRhLnJzc2kpXG5cbiAgY29ubmVjdGVkOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgbXlvLnNlc3Npb24ub25Db25uZWN0ZWQoZXZlbnREYXRhLnZlcnNpb24sIGV2ZW50RGF0YS50aW1lc3RhbXApXG4gICAgQHRyaWdnZXIobXlvLCAnY29ubmVjdGVkJywgZXZlbnREYXRhKVxuXG4gIGRpc2Nvbm5lY3RlZDogKG15bywgZXZlbnREYXRhKSAtPlxuICAgICMgZGVzdHJveSBteW8gaW5zdGFuY2U/XG4gICAgQHJlbW92ZVNlc3Npb24obXlvKVxuICAgIEB0cmlnZ2VyKG15bywgJ2Rpc2Nvbm5lY3RlZCcsIGV2ZW50RGF0YSlcblxuICBkZWZhdWx0OiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgY29uc29sZS5sb2coJ1VuaGFuZGxlZCBldmVudDonLCBldmVudERhdGEpXG5cblxuY2xhc3MgRXh0ZW5kZWRQcm94eUV2ZW50TWFuYWdlciBleHRlbmRzIFByb3h5RXZlbnRNYW5hZ2VyXG4gIG9yaWVudGF0aW9uOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgIyBjb21wbGV0ZWx5IG92ZXJyaWRlcyBwYXJlbnQncyBvcmllbnRhdGlvbiBtZXRob2RcbiAgICAjIGFkZCBhbiBvZmZzZXQgdG8gdGhlIG9yaWVudGF0aW9uIGRhdGE/XG4gICAgc3RhdGUgPSBteW8uc2Vzc2lvbi5leHRyYVxuICAgIG9yaWVudGF0aW9uRGF0YSA9IHtcbiAgICAgIHg6IGV2ZW50RGF0YS5vcmllbnRhdGlvbi54IC0gc3RhdGUuemVyb09yaWVudGF0aW9uT2Zmc2V0LnhcbiAgICAgIHk6IGV2ZW50RGF0YS5vcmllbnRhdGlvbi55IC0gc3RhdGUuemVyb09yaWVudGF0aW9uT2Zmc2V0LnlcbiAgICAgIHo6IGV2ZW50RGF0YS5vcmllbnRhdGlvbi56IC0gc3RhdGUuemVyb09yaWVudGF0aW9uT2Zmc2V0LnpcbiAgICAgIHc6IGV2ZW50RGF0YS5vcmllbnRhdGlvbi53IC0gc3RhdGUuemVyb09yaWVudGF0aW9uT2Zmc2V0LndcbiAgICB9XG4gICAgZ3lyb3Njb3BlRGF0YSA9IHtcbiAgICAgIHg6IGV2ZW50RGF0YS5neXJvc2NvcGVbMF1cbiAgICAgIHk6IGV2ZW50RGF0YS5neXJvc2NvcGVbMV1cbiAgICAgIHo6IGV2ZW50RGF0YS5neXJvc2NvcGVbMl1cbiAgICB9XG4gICAgYWNjZWxlcm9tZXRlckRhdGEgPSB7XG4gICAgICB4OiBldmVudERhdGEuYWNjZWxlcm9tZXRlclswXVxuICAgICAgeTogZXZlbnREYXRhLmFjY2VsZXJvbWV0ZXJbMV1cbiAgICAgIHo6IGV2ZW50RGF0YS5hY2NlbGVyb21ldGVyWzJdXG4gICAgfVxuICAgIGltdURhdGEgPSB7XG4gICAgICBneXJvc2NvcGU6IGd5cm9zY29wZURhdGFcbiAgICAgIGFjY2VsZXJvbWV0ZXI6IGFjY2VsZXJvbWV0ZXJEYXRhXG4gICAgICBvcmllbnRhdGlvbjogb3JpZW50YXRpb25EYXRhXG4gICAgfVxuICAgIHN0YXRlLmxhc3RPcmllbnRhdGlvbkRhdGEgPSBvcmllbnRhdGlvbkRhdGFcblxuICAgIHN1cGVyKG15bywgb3JpZW50YXRpb25EYXRhKVxuICAgIEBneXJvc2NvcGUobXlvLCBneXJvc2NvcGVEYXRhKVxuICAgIEBhY2NlbGVyb21ldGVyKG15bywgYWNjZWxlcm9tZXRlckRhdGEpXG4gICAgQGltdShteW8sIGltdURhdGEpXG5cbiAgZ3lyb3Njb3BlOiAobXlvLCBldmVudERhdGEpIC0+XG4gICAgQHRyaWdnZXIobXlvLCAnZ3lyb3Njb3BlJywgZXZlbnREYXRhKVxuXG4gIGFjY2VsZXJvbWV0ZXI6IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICBAdHJpZ2dlcihteW8sICdhY2NlbGVyb21ldGVyJywgZXZlbnREYXRhKVxuXG4gIGltdTogKG15bywgZXZlbnREYXRhKSAtPlxuICAgIEB0cmlnZ2VyKG15bywgJ2ltdScsIGV2ZW50RGF0YSlcblxuXG5jbGFzcyBFeHBlcmltZW50YWxQcm94eUV2ZW50TWFuYWdlciBleHRlbmRzIEV4dGVuZGVkUHJveHlFdmVudE1hbmFnZXJcbiAgaW5pdFNlc3Npb246IChteW8pIC0+XG4gICAgaGFkU2Vzc2lvbiA9IHN1cGVyXG5cbiAgICBpZiBub3QgaGFkU2Vzc2lvblxuICAgICAgXy5leHRlbmQobXlvLnNlc3Npb24uZXh0cmEsIHtcbiAgICAgICAgd2FzUmlnaHQ6IGZhbHNlXG4gICAgICAgIHNlbnNpdGl2aXR5OiAyMFxuICAgICAgICBsYXN0SU1VOiBudWxsXG4gICAgICAgIGRvdWJsZVRhcDoge1xuICAgICAgICAgIHRocmVzaG9sZDogMC45XG4gICAgICAgICAgdGltZTogWzgwLCAzMDBdXG4gICAgICAgIH1cbiAgICAgICAgemVyb09yaWVudGF0aW9uT2Zmc2V0OiB7eDogMCwgeTogMCwgejogMCwgdzogMH1cbiAgICAgIH0pXG5cbiAgYWNjZWxlcm9tZXRlcjogKG15bywgZXZlbnREYXRhKSAtPlxuICAgICMgYWRkIGRvdWJsZV90YXAgZXZlbnRcbiAgICAjIGFsbCByaWdodHMgZm9yIHRoaXMgZXZlbnQgZ28gdG8gc3RvbGtzZG9yZiAoIGh0dHBzOi8vZ2l0aHViLmNvbS9zdG9sa3Nkb3JmL215by5qcy5naXQgKVxuICAgIHN1cGVyXG5cbiAgICBzdGF0ZSA9IG15by5zZXNzaW9uLmV4dHJhXG5cbiAgICBpZiBub3Qgc3RhdGUubGFzdElNVVxuICAgICAgcmV0dXJuXG5cbiAgICBkb3VibGVUYXBPcHRpb25zID0gc3RhdGUuZG91YmxlVGFwXG4gICAgbGFzdCA9IHN0YXRlLmxhc3RJTVUuYWNjZWxlcm9tZXRlclxuXG4gICAgeSA9IE1hdGguYWJzKGV2ZW50RGF0YS55KVxuICAgIHogPSBNYXRoLmFicyhldmVudERhdGEueilcbiAgICBkZWx0YSA9IE1hdGguYWJzKE1hdGguYWJzKGxhc3QueSkgLSB5KSArIE1hdGguYWJzKE1hdGguYWJzKGxhc3QueikgLSB6KVxuXG4gICAgaWYgZGVsdGEgPiBkb3VibGVUYXBPcHRpb25zLnRocmVzaG9sZFxuICAgICAgaWYgc3RhdGUubGFzdF90YXBcbiAgICAgICAgZGlmZiA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gc3RhdGUubGFzdF90YXBcblxuICAgICAgICBpZiBkaWZmID4gZG91YmxlVGFwT3B0aW9ucy50aW1lWzBdIGFuZCBkaWZmIDwgZG91YmxlVGFwT3B0aW9ucy50aW1lWzFdXG4gICAgICAgICAgIyB0cmlnZ2VyIGRvdWJsZSB0YXAgZXZlbnRcbiAgICAgICAgICBAZG91YmxlX3RhcChteW8sIGV2ZW50RGF0YSlcblxuICAgICAgc3RhdGUubGFzdF90YXAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuXG4gIGltdTogKG15bywgZXZlbnREYXRhKSAtPlxuICAgICMgYWRkIHNsYXBfbGVmdCBldmVudFxuICAgIG15by5zZXNzaW9uLmV4dHJhLmxhc3RJTVUgPSBldmVudERhdGFcbiAgICBzdXBlclxuICAgIGV2ZW50RGF0YSA9IGV2ZW50RGF0YS5vcmllbnRhdGlvblxuXG4gICAgc3RhdGUgPSBteW8uc2Vzc2lvbi5leHRyYVxuICAgIHNlbnNSaWdodCA9ICgyMCArIHN0YXRlLnNlbnNpdGl2aXR5KSAqIC0xXG5cbiAgICBpZiBldmVudERhdGEueCA8IHNlbnNSaWdodCBhbmQgbm90IHN0YXRlLndhc1JpZ2h0XG4gICAgICBzdGF0ZS53YXNSaWdodCA9IHRydWVcbiAgICAgIHJldHVyblxuXG4gICAgc2Vuc0xlZnQgPSA4MCArIChzdGF0ZS5zZW5zaXRpdml0eSAqIDIpXG5cbiAgICBpZiBldmVudERhdGEueCA+IHNlbnNMZWZ0IGFuZCBzdGF0ZS53YXNSaWdodFxuICAgICAgIyB0cmlnZ2VyIHNsYXAgbGVmdCBldmVudFxuICAgICAgQHNsYXBfbGVmdChteW8sIGV2ZW50RGF0YSlcbiAgICAgIHN0YXRlLndhc1JpZ2h0ID0gZmFsc2VcblxuICBzbGFwX2xlZnQ6IChteW8sIGV2ZW50RGF0YSkgLT5cbiAgICBAdHJpZ2dlcihteW8sICdzbGFwX2xlZnQnLCBldmVudERhdGEpXG5cbiAgZG91YmxlX3RhcDogKG15bywgZXZlbnREYXRhKSAtPlxuICAgIEB0cmlnZ2VyKG15bywgJ2RvdWJsZV90YXAnLCBldmVudERhdGEpXG5cbiAgICAjIGFsc28gcmVzZXQgbXlvJ3Mgb3JpZW50YXRpb24gP1xuICAgIG15by56ZXJvT3JpZW50YXRpb24oKVxuXG5cbl8uZXh0ZW5kKGV4cG9ydHMsIHtcbiAgRXZlbnRzOiBFdmVudHNcbiAgU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb25cbiAgUHJveHlFdmVudE1hbmFnZXI6IFByb3h5RXZlbnRNYW5hZ2VyXG4gIEV4dGVuZGVkUHJveHlFdmVudE1hbmFnZXI6IEV4dGVuZGVkUHJveHlFdmVudE1hbmFnZXJcbiAgRXhwZXJpbWVudGFsUHJveHlFdmVudE1hbmFnZXI6IEV4cGVyaW1lbnRhbFByb3h5RXZlbnRNYW5hZ2VyXG59KVxuIl19